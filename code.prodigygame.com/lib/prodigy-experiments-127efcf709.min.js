! function(e, t) {
    "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? exports.prodigyExperiments = t() : e.prodigyExperiments = t()
}(window, (function() {
    return function(e) {
        var t = {};

        function r(n) {
            if (t[n]) return t[n].exports;
            var i = t[n] = {
                i: n,
                l: !1,
                exports: {}
            };
            return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports
        }
        return r.m = e, r.c = t, r.d = function(e, t, n) {
            r.o(e, t) || Object.defineProperty(e, t, {
                enumerable: !0,
                get: n
            })
        }, r.r = function(e) {
            "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {
                value: "Module"
            }), Object.defineProperty(e, "__esModule", {
                value: !0
            })
        }, r.t = function(e, t) {
            if (1 & t && (e = r(e)), 8 & t) return e;
            if (4 & t && "object" == typeof e && e && e.__esModule) return e;
            var n = Object.create(null);
            if (r.r(n), Object.defineProperty(n, "default", {
                    enumerable: !0,
                    value: e
                }), 2 & t && "string" != typeof e)
                for (var i in e) r.d(n, i, function(t) {
                    return e[t]
                }.bind(null, i));
            return n
        }, r.n = function(e) {
            var t = e && e.__esModule ? function() {
                return e.default
            } : function() {
                return e
            };
            return r.d(t, "a", t), t
        }, r.o = function(e, t) {
            return Object.prototype.hasOwnProperty.call(e, t)
        }, r.p = "", r(r.s = 13)
    }([function(e, t, r) {
        "use strict";

        function n(e) {
            for (var r in e) t.hasOwnProperty(r) || (t[r] = e[r])
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), n(r(5)), n(r(6)), n(r(14))
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n, i = r(0),
            o = r(18),
            s = r(2),
            a = r(26),
            u = (n = r(32)) && "object" == typeof n && "default" in n ? n.default : n,
            l = function() {
                return (l = Object.assign || function(e) {
                    for (var t, r = 1, n = arguments.length; r < n; r++)
                        for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                    return e
                }).apply(this, arguments)
            };

        function c() {
            for (var e = 0, t = 0, r = arguments.length; t < r; t++) e += arguments[t].length;
            var n = Array(e),
                i = 0;
            for (t = 0; t < r; t++)
                for (var o = arguments[t], s = 0, a = o.length; s < a; s++, i++) n[i] = o[s];
            return n
        }
        var f = {
                NOTSET: 0,
                DEBUG: 1,
                INFO: 2,
                WARNING: 3,
                ERROR: 4
            },
            p = {
                CONDITION_EVALUATOR_ERROR: "%s: Error evaluating audience condition of type %s: %s",
                DATAFILE_AND_SDK_KEY_MISSING: "%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",
                EXPERIMENT_KEY_NOT_IN_DATAFILE: "%s: Experiment key %s is not in datafile.",
                FEATURE_NOT_IN_DATAFILE: "%s: Feature key %s is not in datafile.",
                IMPROPERLY_FORMATTED_EXPERIMENT: "%s: Experiment key %s is improperly formatted.",
                INVALID_ATTRIBUTES: "%s: Provided attributes are in an invalid format.",
                INVALID_BUCKETING_ID: "%s: Unable to generate hash for bucketing ID %s: %s",
                INVALID_DATAFILE: "%s: Datafile is invalid - property %s: %s",
                INVALID_DATAFILE_MALFORMED: "%s: Datafile is invalid because it is malformed.",
                INVALID_CONFIG: "%s: Provided Optimizely config is in an invalid format.",
                INVALID_JSON: "%s: JSON object is not valid.",
                INVALID_ERROR_HANDLER: '%s: Provided "errorHandler" is in an invalid format.',
                INVALID_EVENT_DISPATCHER: '%s: Provided "eventDispatcher" is in an invalid format.',
                INVALID_EVENT_TAGS: "%s: Provided event tags are in an invalid format.",
                INVALID_EXPERIMENT_KEY: "%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",
                INVALID_EXPERIMENT_ID: "%s: Experiment ID %s is not in datafile.",
                INVALID_GROUP_ID: "%s: Group ID %s is not in datafile.",
                INVALID_LOGGER: '%s: Provided "logger" is in an invalid format.',
                INVALID_ROLLOUT_ID: "%s: Invalid rollout ID %s attached to feature %s",
                INVALID_USER_ID: "%s: Provided user ID is in an invalid format.",
                INVALID_USER_PROFILE_SERVICE: "%s: Provided user profile service instance is in an invalid format: %s.",
                NO_DATAFILE_SPECIFIED: "%s: No datafile specified. Cannot start optimizely.",
                NO_JSON_PROVIDED: "%s: No JSON object to validate against schema.",
                NO_VARIATION_FOR_EXPERIMENT_KEY: "%s: No variation key %s defined in datafile for experiment %s.",
                UNDEFINED_ATTRIBUTE: "%s: Provided attribute: %s has an undefined value.",
                UNRECOGNIZED_ATTRIBUTE: "%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",
                UNABLE_TO_CAST_VALUE: "%s: Unable to cast value %s to type %s, returning null.",
                USER_NOT_IN_FORCED_VARIATION: "%s: User %s is not in the forced variation map. Cannot remove their forced variation.",
                USER_PROFILE_LOOKUP_ERROR: '%s: Error while looking up user profile for user ID "%s": %s.',
                USER_PROFILE_SAVE_ERROR: '%s: Error while saving user profile for user ID "%s": %s.',
                VARIABLE_KEY_NOT_IN_DATAFILE: '%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',
                VARIATION_ID_NOT_IN_DATAFILE: "%s: No variation ID %s defined in datafile for experiment %s.",
                VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT: "%s: Variation ID %s is not in the datafile.",
                INVALID_INPUT_FORMAT: "%s: Provided %s is in an invalid format.",
                INVALID_DATAFILE_VERSION: "%s: This version of the JavaScript SDK does not support the given datafile version: %s",
                INVALID_VARIATION_KEY: "%s: Provided variation key is in an invalid format."
            },
            d = {
                ACTIVATE_USER: "%s: Activating user %s in experiment %s.",
                DISPATCH_CONVERSION_EVENT: "%s: Dispatching conversion event to URL %s with params %s.",
                DISPATCH_IMPRESSION_EVENT: "%s: Dispatching impression event to URL %s with params %s.",
                DEPRECATED_EVENT_VALUE: "%s: Event value is deprecated in %s call.",
                EVENT_KEY_NOT_FOUND: "%s: Event key %s is not in datafile.",
                EXPERIMENT_NOT_RUNNING: "%s: Experiment %s is not running.",
                FEATURE_ENABLED_FOR_USER: "%s: Feature %s is enabled for user %s.",
                FEATURE_NOT_ENABLED_FOR_USER: "%s: Feature %s is not enabled for user %s.",
                FEATURE_HAS_NO_EXPERIMENTS: "%s: Feature %s is not attached to any experiments.",
                FAILED_TO_PARSE_VALUE: '%s: Failed to parse event value "%s" from event tags.',
                FAILED_TO_PARSE_REVENUE: '%s: Failed to parse revenue value "%s" from event tags.',
                FORCED_BUCKETING_FAILED: "%s: Variation key %s is not in datafile. Not activating user %s.",
                INVALID_OBJECT: "%s: Optimizely object is not valid. Failing %s.",
                INVALID_CLIENT_ENGINE: "%s: Invalid client engine passed: %s. Defaulting to node-sdk.",
                INVALID_DEFAULT_DECIDE_OPTIONS: "%s: Provided default decide options is not an array.",
                INVALID_DECIDE_OPTIONS: "%s: Provided decide options is not an array. Using default decide options.",
                INVALID_VARIATION_ID: "%s: Bucketed into an invalid variation ID. Returning null.",
                NOTIFICATION_LISTENER_EXCEPTION: "%s: Notification listener for (%s) threw exception: %s",
                NO_ROLLOUT_EXISTS: "%s: There is no rollout of feature %s.",
                NOT_ACTIVATING_USER: "%s: Not activating user %s for experiment %s.",
                NOT_TRACKING_USER: "%s: Not tracking user %s.",
                PARSED_REVENUE_VALUE: '%s: Parsed revenue value "%s" from event tags.',
                PARSED_NUMERIC_VALUE: '%s: Parsed event value "%s" from event tags.',
                RETURNING_STORED_VARIATION: '%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',
                ROLLOUT_HAS_NO_EXPERIMENTS: "%s: Rollout of feature %s has no experiments",
                SAVED_VARIATION: '%s: Saved variation "%s" of experiment "%s" for user "%s".',
                SAVED_VARIATION_NOT_FOUND: "%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",
                SHOULD_NOT_DISPATCH_ACTIVATE: '%s: Experiment %s is not in "Running" state. Not activating user.',
                SKIPPING_JSON_VALIDATION: "%s: Skipping JSON schema validation.",
                TRACK_EVENT: "%s: Tracking event %s for user %s.",
                UNRECOGNIZED_DECIDE_OPTION: "%s: Unrecognized decide option %s provided.",
                USER_ASSIGNED_TO_EXPERIMENT_BUCKET: "%s: Assigned bucket %s to user with bucketing ID %s.",
                USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP: "%s: User %s is in experiment %s of group %s.",
                USER_BUCKETED_INTO_TARGETING_RULE: "%s: User %s bucketed into targeting rule %s.",
                USER_IN_FEATURE_EXPERIMENT: "%s: User %s is in variation %s of experiment %s on the feature %s.",
                USER_IN_ROLLOUT: "%s: User %s is in rollout of feature %s.",
                USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE: "%s: User %s bucketed into everyone targeting rule.",
                USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE: "%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",
                USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP: "%s: User %s is not in experiment %s of group %s.",
                USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP: "%s: User %s is not in any experiment of group %s.",
                USER_NOT_BUCKETED_INTO_TARGETING_RULE: "%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",
                USER_NOT_IN_FEATURE_EXPERIMENT: "%s: User %s is not in any experiment on the feature %s.",
                USER_NOT_IN_ROLLOUT: "%s: User %s is not in rollout of feature %s.",
                USER_FORCED_IN_VARIATION: "%s: User %s is forced in variation %s.",
                USER_MAPPED_TO_FORCED_VARIATION: "%s: Set variation %s for experiment %s and user %s in the forced variation map.",
                USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE: "%s: User %s does not meet conditions for targeting rule %s.",
                USER_MEETS_CONDITIONS_FOR_TARGETING_RULE: "%s: User %s meets conditions for targeting rule %s.",
                USER_HAS_VARIATION: "%s: User %s is in variation %s of experiment %s.",
                USER_HAS_FORCED_VARIATION: "%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",
                USER_HAS_NO_VARIATION: "%s: User %s is in no variation of experiment %s.",
                USER_HAS_NO_FORCED_VARIATION: "%s: User %s is not in the forced variation map.",
                USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT: "%s: No experiment %s mapped to user %s in the forced variation map.",
                USER_NOT_IN_ANY_EXPERIMENT: "%s: User %s is not in any experiment of group %s.",
                USER_NOT_IN_EXPERIMENT: "%s: User %s does not meet conditions to be in experiment %s.",
                USER_RECEIVED_DEFAULT_VARIABLE_VALUE: '%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',
                FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE: '%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',
                VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE: '%s: Variable "%s" is not used in variation "%s". Returning default value.',
                USER_RECEIVED_VARIABLE_VALUE: '%s: Got variable value "%s" for variable "%s" of feature flag "%s"',
                VALID_DATAFILE: "%s: Datafile is valid.",
                VALID_USER_PROFILE_SERVICE: "%s: Valid user profile service provided.",
                VARIATION_REMOVED_FOR_USER: "%s: Variation mapped to experiment %s has been removed for user %s.",
                VARIABLE_REQUESTED_WITH_WRONG_TYPE: '%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',
                VALID_BUCKETING_ID: '%s: BucketingId is valid: "%s"',
                BUCKETING_ID_NOT_STRING: "%s: BucketingID attribute is not a string. Defaulted to userId",
                EVALUATING_AUDIENCE: '%s: Starting to evaluate audience "%s" with conditions: %s.',
                EVALUATING_AUDIENCES_COMBINED: '%s: Evaluating audiences for %s "%s": %s.',
                AUDIENCE_EVALUATION_RESULT: '%s: Audience "%s" evaluated to %s.',
                AUDIENCE_EVALUATION_RESULT_COMBINED: "%s: Audiences for %s %s collectively evaluated to %s.",
                MISSING_ATTRIBUTE_VALUE: '%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',
                UNEXPECTED_CONDITION_VALUE: "%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",
                UNEXPECTED_TYPE: '%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',
                UNEXPECTED_TYPE_NULL: '%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',
                UNKNOWN_CONDITION_TYPE: "%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",
                UNKNOWN_MATCH_TYPE: "%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",
                UPDATED_OPTIMIZELY_CONFIG: "%s: Updated Optimizely config to revision %s (project id %s)",
                OUT_OF_BOUNDS: '%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',
                UNABLE_TO_ATTACH_UNLOAD: '%s: unable to bind optimizely.close() to page unload event: "%s"'
            },
            h = {
                BOT_FILTERING: "$opt_bot_filtering",
                BUCKETING_ID: "$opt_bucketing_id",
                STICKY_BUCKETING_KEY: "$opt_experiment_bucket_map",
                USER_AGENT: "$opt_user_agent"
            },
            g = ["node-sdk", "react-sdk", "javascript-sdk", "react-native-sdk", "react-native-js-sdk"],
            E = s.NOTIFICATION_TYPES,
            _ = {
                AB_TEST: "ab-test",
                FEATURE: "feature",
                FEATURE_TEST: "feature-test",
                FEATURE_VARIABLE: "feature-variable",
                ALL_FEATURE_VARIABLES: "all-feature-variables",
                FLAG: "flag"
            },
            v = {
                FEATURE_TEST: "feature-test",
                ROLLOUT: "rollout",
                EXPERIMENT: "experiment"
            },
            I = {
                RULE: "rule",
                EXPERIMENT: "experiment"
            },
            y = {
                BOOLEAN: "boolean",
                DOUBLE: "double",
                INTEGER: "integer",
                STRING: "string",
                JSON: "json"
            },
            O = {
                V2: "2",
                V3: "3",
                V4: "4"
            },
            T = {
                SDK_NOT_READY: "Optimizely SDK not configured properly yet.",
                FLAG_KEY_INVALID: 'No flag was found for key "%s".',
                VARIABLE_VALUE_INVALID: 'Variable value for key "%s" is invalid or wrong type.'
            },
            R = Object.freeze({
                __proto__: null,
                LOG_LEVEL: f,
                ERROR_MESSAGES: p,
                LOG_MESSAGES: d,
                CONTROL_ATTRIBUTES: h,
                JAVASCRIPT_CLIENT_ENGINE: "javascript-sdk",
                NODE_CLIENT_ENGINE: "node-sdk",
                REACT_CLIENT_ENGINE: "react-sdk",
                REACT_NATIVE_CLIENT_ENGINE: "react-native-sdk",
                REACT_NATIVE_JS_CLIENT_ENGINE: "react-native-js-sdk",
                NODE_CLIENT_VERSION: "4.7.0",
                VALID_CLIENT_ENGINES: g,
                NOTIFICATION_TYPES: E,
                DECISION_NOTIFICATION_TYPES: _,
                DECISION_SOURCES: v,
                AUDIENCE_EVALUATION_TYPES: I,
                FEATURE_VARIABLE_TYPES: y,
                DATAFILE_VERSIONS: O,
                DECISION_MESSAGES: T
            }),
            A = "CONFIG_VALIDATOR",
            N = [O.V2, O.V3, O.V4],
            m = function(e) {
                if ("object" == typeof e && null !== e) {
                    var t = e,
                        r = t.errorHandler,
                        n = t.eventDispatcher,
                        i = t.logger;
                    if (r && "function" != typeof r.handleError) throw new Error(s.sprintf(p.INVALID_ERROR_HANDLER, A));
                    if (n && "function" != typeof n.dispatchEvent) throw new Error(s.sprintf(p.INVALID_EVENT_DISPATCHER, A));
                    if (i && "function" != typeof i.log) throw new Error(s.sprintf(p.INVALID_LOGGER, A));
                    return !0
                }
                throw new Error(s.sprintf(p.INVALID_CONFIG, A))
            },
            L = {
                handleError: function() {}
            },
            b = {
                dispatchEvent: function(e, t) {
                    var r, n = e.params,
                        i = e.url;
                    "POST" === e.httpVerb ? ((r = new XMLHttpRequest).open("POST", i, !0), r.setRequestHeader("Content-Type", "application/json"), r.onreadystatechange = function() {
                        if (4 === r.readyState && t && "function" == typeof t) try {
                            t({
                                statusCode: r.status
                            })
                        } catch (e) {}
                    }, r.send(JSON.stringify(n))) : (i += "?wxhr=true", n && (i += "&" + function(e) {
                        return Object.keys(e).map((function(t) {
                            return encodeURIComponent(t) + "=" + encodeURIComponent(e[t])
                        })).join("&")
                    }(n)), (r = new XMLHttpRequest).open("GET", i, !0), r.onreadystatechange = function() {
                        if (4 === r.readyState && t && "function" == typeof t) try {
                            t({
                                statusCode: r.status
                            })
                        } catch (e) {}
                    }, r.send())
                }
            },
            U = function() {
                function e() {}
                return e.prototype.log = function() {}, e
            }();

        function S(e) {
            return new i.ConsoleLogHandler(e)
        }
        var D, C, V = Object.freeze({
            __proto__: null,
            NoOpLogger: U,
            createLogger: S,
            createNoOpLogger: function() {
                return new U
            }
        });

        function P(e, t, r) {
            return {
                variationKey: null,
                enabled: !1,
                variables: {},
                ruleKey: null,
                flagKey: e,
                userContext: t,
                reasons: r
            }
        }! function(e) {
            e.BOOLEAN = "boolean", e.DOUBLE = "double", e.INTEGER = "integer", e.STRING = "string", e.JSON = "json"
        }(D || (D = {})), (C = t.OptimizelyDecideOption || (t.OptimizelyDecideOption = {})).DISABLE_DECISION_EVENT = "DISABLE_DECISION_EVENT", C.ENABLED_FLAGS_ONLY = "ENABLED_FLAGS_ONLY", C.IGNORE_USER_PROFILE_SERVICE = "IGNORE_USER_PROFILE_SERVICE", C.INCLUDE_REASONS = "INCLUDE_REASONS", C.EXCLUDE_VARIABLES = "EXCLUDE_VARIABLES";
        var F = function() {
                function e(e) {
                    var t, r = e.optimizely,
                        n = e.userId,
                        i = e.attributes;
                    this.optimizely = r, this.userId = n, this.attributes = null !== (t = l({}, i)) && void 0 !== t ? t : {}
                }
                return e.prototype.setAttribute = function(e, t) {
                    this.attributes[e] = t
                }, e.prototype.getUserId = function() {
                    return this.userId
                }, e.prototype.getAttributes = function() {
                    return l({}, this.attributes)
                }, e.prototype.getOptimizely = function() {
                    return this.optimizely
                }, e.prototype.decide = function(e, t) {
                    return void 0 === t && (t = []), this.optimizely.decide(this.cloneUserContext(), e, t)
                }, e.prototype.decideForKeys = function(e, t) {
                    return void 0 === t && (t = []), this.optimizely.decideForKeys(this.cloneUserContext(), e, t)
                }, e.prototype.decideAll = function(e) {
                    return void 0 === e && (e = []), this.optimizely.decideAll(this.cloneUserContext(), e)
                }, e.prototype.trackEvent = function(e, t) {
                    this.optimizely.track(e, this.userId, this.attributes, t)
                }, e.prototype.cloneUserContext = function() {
                    return new e({
                        optimizely: this.getOptimizely(),
                        userId: this.getUserId(),
                        attributes: this.getAttributes()
                    })
                }, e
            }(),
            M = Math.pow(2, 53),
            x = {
                assign: function(e) {
                    for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                    if (!e) return {};
                    if ("function" == typeof Object.assign) return Object.assign.apply(Object, c([e], t));
                    for (var n = Object(e), i = 0; i < t.length; i++) {
                        var o = t[i];
                        if (null != o)
                            for (var s in o) Object.prototype.hasOwnProperty.call(o, s) && (n[s] = o[s])
                    }
                    return n
                },
                currentTimestamp: function() {
                    return Math.round((new Date).getTime())
                },
                isSafeInteger: function(e) {
                    return "number" == typeof e && Math.abs(e) <= M
                },
                keyBy: function(e, t) {
                    return e ? s.keyBy(e, (function(e) {
                        return e[t]
                    })) : {}
                },
                uuid: s.generateUUID,
                isNumber: function(e) {
                    return "number" == typeof e
                }
            },
            w = ["and", "or", "not"];

        function k(e, t) {
            if (Array.isArray(e)) {
                var r = e[0],
                    n = e.slice(1);
                switch ("string" == typeof r && -1 === w.indexOf(r) && (r = "or", n = e), r) {
                    case "and":
                        return function(e, t) {
                            var r = !1;
                            if (Array.isArray(e)) {
                                for (var n = 0; n < e.length; n++) {
                                    var i = k(e[n], t);
                                    if (!1 === i) return !1;
                                    null === i && (r = !0)
                                }
                                return !r || null
                            }
                            return null
                        }(n, t);
                    case "not":
                        return function(e, t) {
                            if (Array.isArray(e) && e.length > 0) {
                                var r = k(e[0], t);
                                return null === r ? null : !r
                            }
                            return null
                        }(n, t);
                    default:
                        return function(e, t) {
                            var r = !1;
                            if (Array.isArray(e)) {
                                for (var n = 0; n < e.length; n++) {
                                    var i = k(e[n], t);
                                    if (!0 === i) return !0;
                                    null === i && (r = !0)
                                }
                                return !!r && null
                            }
                            return null
                        }(n, t)
                }
            }
            return t(e)
        }
        var B = function() {
                function e(t, r) {
                    var n, i;
                    this.sdkKey = null !== (n = t.sdkKey) && void 0 !== n ? n : "", this.environmentKey = null !== (i = t.environmentKey) && void 0 !== i ? i : "", this.attributes = t.attributes, this.audiences = e.getAudiences(t), this.events = t.events, this.revision = t.revision;
                    var o = (t.featureFlags || []).reduce((function(e, t) {
                            return e[t.id] = t.variables, e
                        }), {}),
                        s = e.getExperimentsMapById(t, o);
                    this.experimentsMap = e.getExperimentsKeyMap(s), this.featuresMap = e.getFeaturesMap(t, o, s), this.datafile = r
                }
                return e.prototype.getDatafile = function() {
                    return this.datafile
                }, e.getAudiences = function(e) {
                    var t = [],
                        r = [];
                    return (e.typedAudiences || []).forEach((function(e) {
                        t.push({
                            id: e.id,
                            conditions: JSON.stringify(e.conditions),
                            name: e.name
                        }), r.push(e.id)
                    })), (e.audiences || []).forEach((function(e) {
                        -1 === r.indexOf(e.id) && "$opt_dummy_audience" != e.id && t.push({
                            id: e.id,
                            conditions: JSON.stringify(e.conditions),
                            name: e.name
                        })
                    })), t
                }, e.getSerializedAudiences = function(t, r) {
                    var n = "";
                    if (t) {
                        var i = "";
                        t.forEach((function(t) {
                            var o = "";
                            if (t instanceof Array) o = "(" + (o = e.getSerializedAudiences(t, r)) + ")";
                            else if (w.indexOf(t) > -1) i = t.toUpperCase();
                            else {
                                var s = r[t] ? r[t].name : t;
                                n || "NOT" === i ? (i = "" === i ? "OR" : i, n = "" === n ? i + ' "' + r[t].name + '"' : n.concat(" " + i + ' "' + s + '"')) : n = '"' + s + '"'
                            }
                            "" !== o && ("" !== n || "NOT" === i ? (i = "" === i ? "OR" : i, n = "" === n ? i + " " + o : n.concat(" " + i + " " + o)) : n = n.concat(o))
                        }))
                    }
                    return n
                }, e.getExperimentAudiences = function(t, r) {
                    return t.audienceConditions ? e.getSerializedAudiences(t.audienceConditions, r.audiencesById) : ""
                }, e.mergeFeatureVariables = function(e, t, r, n, i) {
                    var o = (e[r] || []).reduce((function(e, t) {
                        return e[t.key] = {
                            id: t.id,
                            key: t.key,
                            type: t.type,
                            value: t.defaultValue
                        }, e
                    }), {});
                    return (n || []).forEach((function(e) {
                        var r = t[e.id],
                            n = {
                                id: e.id,
                                key: r.key,
                                type: r.type,
                                value: i ? e.value : r.defaultValue
                            };
                        o[r.key] = n
                    })), o
                }, e.getVariationsMap = function(t, r, n, i) {
                    return t.reduce((function(t, o) {
                        var s = e.mergeFeatureVariables(r, n, i, o.variables, o.featureEnabled);
                        return t[o.key] = {
                            id: o.id,
                            key: o.key,
                            featureEnabled: o.featureEnabled,
                            variablesMap: s
                        }, t
                    }), {})
                }, e.getVariableIdMap = function(e) {
                    return (e.featureFlags || []).reduce((function(e, t) {
                        return t.variables.forEach((function(t) {
                            e[t.id] = t
                        })), e
                    }), {})
                }, e.getDeliveryRules = function(t, r, n, i) {
                    var o = e.getVariableIdMap(t);
                    return i.map((function(i) {
                        return {
                            id: i.id,
                            key: i.key,
                            audiences: e.getExperimentAudiences(i, t),
                            variationsMap: e.getVariationsMap(i.variations, r, o, n)
                        }
                    }))
                }, e.getRolloutExperimentIds = function(e) {
                    var t = [];
                    return (e || []).forEach((function(e) {
                        e.experiments.forEach((function(e) {
                            t.push(e.id)
                        }))
                    })), t
                }, e.getExperimentsMapById = function(t, r) {
                    var n = e.getVariableIdMap(t),
                        i = this.getRolloutExperimentIds(t.rollouts);
                    return (t.experiments || []).reduce((function(o, s) {
                        if (-1 === i.indexOf(s.id)) {
                            var a = t.experimentFeatureMap[s.id],
                                u = "";
                            a && a.length > 0 && (u = a[0]);
                            var l = e.getVariationsMap(s.variations, r, n, u.toString());
                            o[s.id] = {
                                id: s.id,
                                key: s.key,
                                audiences: e.getExperimentAudiences(s, t),
                                variationsMap: l
                            }
                        }
                        return o
                    }), {})
                }, e.getExperimentsKeyMap = function(e) {
                    var t = {};
                    for (var r in e) {
                        var n = e[r];
                        t[n.key] = n
                    }
                    return t
                }, e.getFeaturesMap = function(t, r, n) {
                    var i = {};
                    return t.featureFlags.forEach((function(o) {
                        var s = {},
                            a = [];
                        o.experimentIds.forEach((function(e) {
                            var t = n[e];
                            t && (s[t.key] = t), a.push(n[e])
                        }));
                        var u = (o.variables || []).reduce((function(e, t) {
                                return e[t.key] = {
                                    id: t.id,
                                    key: t.key,
                                    type: t.type,
                                    value: t.defaultValue
                                }, e
                            }), {}),
                            l = [],
                            c = t.rolloutIdMap[o.rolloutId];
                        c && (l = e.getDeliveryRules(t, r, o.id, c.experiments)), i[o.key] = {
                            id: o.id,
                            key: o.key,
                            experimentRules: a,
                            deliveryRules: l,
                            experimentsMap: s,
                            variablesMap: u
                        }
                    })), i
                }, e
            }(),
            G = "PROJECT_CONFIG",
            j = function(e, t) {
                void 0 === t && (t = null);
                var r, n, i, o, a = (r = e, (o = x.assign({}, r)).audiences = (r.audiences || []).map((function(e) {
                    return x.assign({}, e)
                })), o.experiments = (r.experiments || []).map((function(e) {
                    return x.assign({}, e)
                })), o.featureFlags = (r.featureFlags || []).map((function(e) {
                    return x.assign({}, e)
                })), o.groups = (r.groups || []).map((function(e) {
                    var t = x.assign({}, e);
                    return t.experiments = (e.experiments || []).map((function(e) {
                        return x.assign({}, e)
                    })), t
                })), o.rollouts = (r.rollouts || []).map((function(e) {
                    var t = x.assign({}, e);
                    return t.experiments = (e.experiments || []).map((function(e) {
                        return x.assign({}, e)
                    })), t
                })), o.environmentKey = null !== (n = r.environmentKey) && void 0 !== n ? n : "", o.sdkKey = null !== (i = r.sdkKey) && void 0 !== i ? i : "", o);
                return a.__datafileStr = null === t ? JSON.stringify(e) : t, (a.audiences || []).forEach((function(e) {
                    e.conditions = JSON.parse(e.conditions)
                })), a.audiencesById = x.keyBy(a.audiences, "id"), x.assign(a.audiencesById, x.keyBy(a.typedAudiences, "id")), a.attributeKeyMap = x.keyBy(a.attributes, "key"), a.eventKeyMap = x.keyBy(a.events, "key"), a.groupIdMap = x.keyBy(a.groups, "id"), Object.keys(a.groupIdMap || {}).forEach((function(e) {
                    (a.groupIdMap[e].experiments || []).forEach((function(t) {
                        a.experiments.push(x.assign(t, {
                            groupId: e
                        }))
                    }))
                })), a.rolloutIdMap = x.keyBy(a.rollouts || [], "id"), s.objectValues(a.rolloutIdMap || {}).forEach((function(e) {
                    (e.experiments || []).forEach((function(e) {
                        a.experiments.push(e), e.variationKeyMap = x.keyBy(e.variations, "key")
                    }))
                })), a.experimentKeyMap = x.keyBy(a.experiments, "key"), a.experimentIdMap = x.keyBy(a.experiments, "id"), a.variationIdMap = {}, a.variationVariableUsageMap = {}, (a.experiments || []).forEach((function(e) {
                    e.variationKeyMap = x.keyBy(e.variations, "key"), x.assign(a.variationIdMap, x.keyBy(e.variations, "id")), s.objectValues(e.variationKeyMap || {}).forEach((function(e) {
                        e.variables && (a.variationVariableUsageMap[e.id] = x.keyBy(e.variables, "id"))
                    }))
                })), a.experimentFeatureMap = {}, a.featureKeyMap = x.keyBy(a.featureFlags || [], "key"), s.objectValues(a.featureKeyMap || {}).forEach((function(e) {
                    e.variables.forEach((function(e) {
                        e.type === y.STRING && e.subType === y.JSON && (e.type = y.JSON, delete e.subType)
                    })), e.variableKeyMap = x.keyBy(e.variables, "key"), (e.experimentIds || []).forEach((function(t) {
                        a.experimentFeatureMap[t] ? a.experimentFeatureMap[t].push(e.id) : a.experimentFeatureMap[t] = [e.id]
                    }))
                })), a
            },
            K = function(e, t) {
                var r = e.experimentIdMap[t];
                if (!r) throw new Error(s.sprintf(p.INVALID_EXPERIMENT_ID, G, t));
                return r.layerId
            },
            Y = function(e, t, r) {
                var n = e.attributeKeyMap[t],
                    i = 0 === t.indexOf("$opt_");
                return n ? (i && r.log(f.WARNING, s.sprintf("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.", t, "$opt_")), n.id) : i ? t : (r.log(f.DEBUG, s.sprintf(p.UNRECOGNIZED_ATTRIBUTE, G, t)), null)
            },
            H = function(e, t) {
                var r = e.eventKeyMap[t];
                return r ? r.id : null
            },
            z = function(e, t) {
                var r = e.experimentKeyMap[t];
                if (!r) throw new Error(s.sprintf(p.INVALID_EXPERIMENT_KEY, G, t));
                return r.status
            },
            J = function(e, t) {
                return e.variationIdMap.hasOwnProperty(t) ? e.variationIdMap[t].key : null
            },
            q = function(e, t, r) {
                var n = e.experimentIdMap[t];
                return n.variationKeyMap.hasOwnProperty(r) ? n.variationKeyMap[r].id : null
            },
            X = function(e, t) {
                if (e.experimentKeyMap.hasOwnProperty(t)) {
                    var r = e.experimentKeyMap[t];
                    if (r) return r
                }
                throw new Error(s.sprintf(p.EXPERIMENT_KEY_NOT_IN_DATAFILE, G, t))
            },
            W = function(e, t) {
                var r = e.experimentIdMap[t];
                if (!r) throw new Error(s.sprintf(p.INVALID_EXPERIMENT_ID, G, t));
                return r.trafficAllocation
            },
            Z = function(e, t, r) {
                if (e.experimentIdMap.hasOwnProperty(t)) {
                    var n = e.experimentIdMap[t];
                    if (n) return n
                }
                return r.log(f.ERROR, s.sprintf(p.INVALID_EXPERIMENT_ID, G, t)), null
            },
            $ = function(e, t, r) {
                if (e.featureKeyMap.hasOwnProperty(t)) {
                    var n = e.featureKeyMap[t];
                    if (n) return n
                }
                return r.log(f.ERROR, s.sprintf(p.FEATURE_NOT_IN_DATAFILE, G, t)), null
            },
            Q = function(e) {
                return e.__datafileStr
            },
            ee = function(e) {
                return !!e.sendFlagDecisions
            },
            te = i.getLogger();

        function re(e, t) {
            return e instanceof Error ? e.message : t || "Unknown error"
        }
        var ne = function() {
                function e(e) {
                    this.updateListeners = [], this.configObj = null, this.optimizelyConfigObj = null, this.datafileManager = null;
                    try {
                        if (this.jsonSchemaValidator = e.jsonSchemaValidator, !e.datafile && !e.sdkKey) {
                            var t = new Error(s.sprintf(p.DATAFILE_AND_SDK_KEY_MISSING, "PROJECT_CONFIG_MANAGER"));
                            return this.readyPromise = Promise.resolve({
                                success: !1,
                                reason: re(t)
                            }), void te.error(t)
                        }
                        var r = null;
                        if (e.datafile && (r = this.handleNewDatafile(e.datafile)), e.sdkKey) {
                            var n = {
                                sdkKey: e.sdkKey
                            };
                            this.validateDatafileOptions(e.datafileOptions) && x.assign(n, e.datafileOptions), this.configObj && (n.datafile = Q(this.configObj)), this.datafileManager = new a.HttpPollingDatafileManager(n), this.datafileManager.start(), this.readyPromise = this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this), this.onDatafileManagerReadyReject.bind(this)), this.datafileManager.on("update", this.onDatafileManagerUpdate.bind(this))
                        } else this.configObj ? this.readyPromise = Promise.resolve({
                            success: !0
                        }) : this.readyPromise = Promise.resolve({
                            success: !1,
                            reason: re(r, "Invalid datafile")
                        })
                    } catch (e) {
                        te.error(e), this.readyPromise = Promise.resolve({
                            success: !1,
                            reason: re(e, "Error in initialize")
                        })
                    }
                }
                return e.prototype.onDatafileManagerReadyFulfill = function() {
                    if (this.datafileManager) {
                        var e = this.handleNewDatafile(this.datafileManager.get());
                        return e ? {
                            success: !1,
                            reason: re(e)
                        } : {
                            success: !0
                        }
                    }
                    return {
                        success: !1,
                        reason: re(null, "Datafile manager is not provided")
                    }
                }, e.prototype.onDatafileManagerReadyReject = function(e) {
                    return {
                        success: !1,
                        reason: re(e, "Failed to become ready")
                    }
                }, e.prototype.onDatafileManagerUpdate = function() {
                    this.datafileManager && this.handleNewDatafile(this.datafileManager.get())
                }, e.prototype.validateDatafileOptions = function(e) {
                    return void 0 === e || "object" == typeof e && null !== e
                }, e.prototype.handleNewDatafile = function(e) {
                    var t = function(e) {
                            var t;
                            try {
                                t = function(e) {
                                    if (!e) throw new Error(s.sprintf(p.NO_DATAFILE_SPECIFIED, A));
                                    if ("string" == typeof e) try {
                                        e = JSON.parse(e)
                                    } catch (e) {
                                        throw new Error(s.sprintf(p.INVALID_DATAFILE_MALFORMED, A))
                                    }
                                    if ("object" == typeof e && !Array.isArray(e) && null !== e && -1 === N.indexOf(e.version)) throw new Error(s.sprintf(p.INVALID_DATAFILE_VERSION, A, e.version));
                                    return e
                                }(e.datafile)
                            } catch (e) {
                                return {
                                    configObj: null,
                                    error: e
                                }
                            }
                            if (e.jsonSchemaValidator) try {
                                e.jsonSchemaValidator.validate(t), e.logger.log(f.INFO, s.sprintf(d.VALID_DATAFILE, G))
                            } catch (e) {
                                return {
                                    configObj: null,
                                    error: e
                                }
                            } else e.logger.log(f.INFO, s.sprintf(d.SKIPPING_JSON_VALIDATION, G));
                            var r = [t];
                            return "string" == typeof e.datafile && r.push(e.datafile), {
                                configObj: j.apply(void 0, r),
                                error: null
                            }
                        }({
                            datafile: e,
                            jsonSchemaValidator: this.jsonSchemaValidator,
                            logger: te
                        }),
                        r = t.configObj,
                        n = t.error;
                    if (n) te.error(n);
                    else {
                        var i = this.configObj ? this.configObj.revision : "null";
                        r && i !== r.revision && (this.configObj = r, this.optimizelyConfigObj = function(e, t) {
                            return new B(e, t)
                        }(this.configObj, Q(this.configObj)), this.updateListeners.forEach((function(e) {
                            return e(r)
                        })))
                    }
                    return n
                }, e.prototype.getConfig = function() {
                    return this.configObj
                }, e.prototype.getOptimizelyConfig = function() {
                    return this.optimizelyConfigObj
                }, e.prototype.onReady = function() {
                    return this.readyPromise
                }, e.prototype.onUpdate = function(e) {
                    var t = this;
                    return this.updateListeners.push(e),
                        function() {
                            var r = t.updateListeners.indexOf(e);
                            r > -1 && t.updateListeners.splice(r, 1)
                        }
                }, e.prototype.stop = function() {
                    this.datafileManager && this.datafileManager.stop(), this.updateListeners = []
                }, e
            }(),
            ie = function() {
                function e(e) {
                    var t = this;
                    this.logger = e.logger, this.errorHandler = e.errorHandler, this.notificationListeners = {}, s.objectValues(E).forEach((function(e) {
                        t.notificationListeners[e] = []
                    })), this.listenerId = 1
                }
                return e.prototype.addNotificationListener = function(e, t) {
                    try {
                        if (!(s.objectValues(E).indexOf(e) > -1)) return -1;
                        this.notificationListeners[e] || (this.notificationListeners[e] = []);
                        var r = !1;
                        if ((this.notificationListeners[e] || []).forEach((function(e) {
                                e.callback !== t || (r = !0)
                            })), r) return -1;
                        this.notificationListeners[e].push({
                            id: this.listenerId,
                            callback: t
                        });
                        var n = this.listenerId;
                        return this.listenerId += 1, n
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), -1
                    }
                }, e.prototype.removeNotificationListener = function(e) {
                    var t = this;
                    try {
                        var r, n;
                        if (Object.keys(this.notificationListeners).some((function(i) {
                                return (t.notificationListeners[i] || []).every((function(t, o) {
                                    return t.id !== e || (r = o, n = i, !1)
                                })), void 0 !== r && void 0 !== n
                            })), void 0 !== r && void 0 !== n) return this.notificationListeners[n].splice(r, 1), !0
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e)
                    }
                    return !1
                }, e.prototype.clearAllNotificationListeners = function() {
                    var e = this;
                    try {
                        s.objectValues(E).forEach((function(t) {
                            e.notificationListeners[t] = []
                        }))
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e)
                    }
                }, e.prototype.clearNotificationListeners = function(e) {
                    try {
                        this.notificationListeners[e] = []
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e)
                    }
                }, e.prototype.sendNotifications = function(e, t) {
                    var r = this;
                    try {
                        (this.notificationListeners[e] || []).forEach((function(n) {
                            var i = n.callback;
                            try {
                                i(t)
                            } catch (t) {
                                r.logger.log(f.ERROR, s.sprintf(d.NOTIFICATION_LISTENER_EXCEPTION, "NOTIFICATION_CENTER", e, t.message))
                            }
                        }))
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e)
                    }
                }, e
            }(),
            oe = Math.pow(2, 32),
            se = function(e) {
                var t = [],
                    r = e.experimentIdMap[e.experimentId].groupId;
                if (r) {
                    var n = e.groupIdMap[r];
                    if (!n) throw new Error(s.sprintf(p.INVALID_GROUP_ID, "BUCKETER", r));
                    if ("random" === n.policy) {
                        var i = ae(n, e.bucketingId, e.userId, e.logger);
                        if (null === i) {
                            var o = s.sprintf(d.USER_NOT_IN_ANY_EXPERIMENT, "BUCKETER", e.userId, r);
                            return e.logger.log(f.INFO, o), t.push(o), {
                                result: null,
                                reasons: t
                            }
                        }
                        if (i !== e.experimentId) {
                            var a = s.sprintf(d.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP, "BUCKETER", e.userId, e.experimentKey, r);
                            return e.logger.log(f.INFO, a), t.push(a), {
                                result: null,
                                reasons: t
                            }
                        }
                        var u = s.sprintf(d.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP, "BUCKETER", e.userId, e.experimentKey, r);
                        e.logger.log(f.INFO, u), t.push(u)
                    }
                }
                var l = s.sprintf("%s%s", e.bucketingId, e.experimentId),
                    c = le(l),
                    h = s.sprintf(d.USER_ASSIGNED_TO_EXPERIMENT_BUCKET, "BUCKETER", c, e.userId);
                e.logger.log(f.DEBUG, h), t.push(h);
                var g = ue(c, e.trafficAllocationConfig);
                if (null !== g && !e.variationIdMap[g]) {
                    if (g) {
                        var E = s.sprintf(d.INVALID_VARIATION_ID, "BUCKETER");
                        e.logger.log(f.WARNING, E), t.push(E)
                    }
                    return {
                        result: null,
                        reasons: t
                    }
                }
                return {
                    result: g,
                    reasons: t
                }
            },
            ae = function(e, t, r, n) {
                var i = s.sprintf("%s%s", t, e.id),
                    o = le(i);
                n.log(f.DEBUG, s.sprintf(d.USER_ASSIGNED_TO_EXPERIMENT_BUCKET, "BUCKETER", o, r));
                var a = e.trafficAllocation;
                return ue(o, a)
            },
            ue = function(e, t) {
                for (var r = 0; r < t.length; r++)
                    if (e < t[r].endOfRange) return t[r].entityId;
                return null
            },
            le = function(e) {
                try {
                    var t = u.v3(e, 1) / oe;
                    return Math.floor(1e4 * t)
                } catch (t) {
                    throw new Error(s.sprintf(p.INVALID_BUCKETING_ID, "BUCKETER", e, t.message))
                }
            },
            ce = i.getLogger();

        function fe(e) {
            return /^\d+$/.test(e)
        }

        function pe(e) {
            var t = e.indexOf("-"),
                r = e.indexOf("+");
            return !(t < 0) && (r < 0 || t < r)
        }

        function de(e) {
            var t = e.indexOf("-"),
                r = e.indexOf("+");
            return !(r < 0) && (t < 0 || r < t)
        }

        function he(e) {
            var t = e,
                r = "";
            if (function(e) {
                    return /\s/.test(e)
                }(e)) return ce.warn(d.UNKNOWN_MATCH_TYPE, "SEMANTIC VERSION", e), null;
            if (pe(e) ? (t = e.substring(0, e.indexOf("-")), r = e.substring(e.indexOf("-") + 1)) : de(e) && (t = e.substring(0, e.indexOf("+")), r = e.substring(e.indexOf("+") + 1)), "string" != typeof t || "string" != typeof r) return null;
            var n = t.split(".").length - 1;
            if (n > 2) return ce.warn(d.UNKNOWN_MATCH_TYPE, "SEMANTIC VERSION", e), null;
            var i = t.split(".");
            if (i.length != n + 1) return ce.warn(d.UNKNOWN_MATCH_TYPE, "SEMANTIC VERSION", e), null;
            for (var o = 0, s = i; o < s.length; o++)
                if (!fe(s[o])) return ce.warn(d.UNKNOWN_MATCH_TYPE, "SEMANTIC VERSION", e), null;
            return r && i.push(r), i
        }
        var ge = "CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",
            Ee = i.getLogger(),
            _e = ["exact", "exists", "gt", "ge", "lt", "le", "substring", "semver_eq", "semver_lt", "semver_le", "semver_gt", "semver_ge"],
            ve = {};

        function Ie(e) {
            return "string" == typeof e || "boolean" == typeof e || x.isNumber(e)
        }

        function ye(e, t) {
            var r = e.value,
                n = typeof r,
                i = e.name,
                o = t[i],
                s = typeof o;
            return !Ie(r) || x.isNumber(r) && !x.isSafeInteger(r) ? (Ee.warn(d.UNEXPECTED_CONDITION_VALUE, ge, JSON.stringify(e)), null) : null === o ? (Ee.debug(d.UNEXPECTED_TYPE_NULL, ge, JSON.stringify(e), i), null) : Ie(o) && n === s ? x.isNumber(o) && !x.isSafeInteger(o) ? (Ee.warn(d.OUT_OF_BOUNDS, ge, JSON.stringify(e), i), null) : r === o : (Ee.warn(d.UNEXPECTED_TYPE, ge, JSON.stringify(e), s, i), null)
        }

        function Oe(e, t) {
            var r = e.name,
                n = t[r],
                i = typeof n,
                o = e.value;
            return null !== o && x.isSafeInteger(o) ? null === n ? (Ee.debug(d.UNEXPECTED_TYPE_NULL, ge, JSON.stringify(e), r), !1) : x.isNumber(n) ? !!x.isSafeInteger(n) || (Ee.warn(d.OUT_OF_BOUNDS, ge, JSON.stringify(e), r), !1) : (Ee.warn(d.UNEXPECTED_TYPE, ge, JSON.stringify(e), i, r), !1) : (Ee.warn(d.UNEXPECTED_CONDITION_VALUE, ge, JSON.stringify(e)), !1)
        }

        function Te(e, t) {
            var r = e.name,
                n = t[r],
                i = typeof n,
                o = e.value;
            return "string" != typeof o ? (Ee.warn(d.UNEXPECTED_CONDITION_VALUE, ge, JSON.stringify(e)), null) : null === n ? (Ee.debug(d.UNEXPECTED_TYPE_NULL, ge, JSON.stringify(e), r), null) : "string" != typeof n ? (Ee.warn(d.UNEXPECTED_TYPE, ge, JSON.stringify(e), i, r), null) : function(e, t) {
                var r = he(t),
                    n = he(e);
                if (!r || !n) return null;
                for (var i = r.length, o = 0; o < n.length; o++) {
                    if (i <= o) return pe(e) || de(e) ? 1 : -1;
                    if (fe(r[o])) {
                        var s = parseInt(r[o]),
                            a = parseInt(n[o]);
                        if (s > a) return 1;
                        if (s < a) return -1
                    } else {
                        if (r[o] < n[o]) return pe(e) && !pe(t) ? 1 : -1;
                        if (r[o] > n[o]) return !pe(e) && pe(t) ? -1 : 1
                    }
                }
                return pe(t) && !pe(e) ? -1 : 0
            }(o, n)
        }
        ve.exact = ye, ve.exists = function(e, t) {
            return null != t[e.name]
        }, ve.gt = function(e, t) {
            var r = t[e.name],
                n = e.value;
            return Oe(e, t) && null !== n ? r > n : null
        }, ve.ge = function(e, t) {
            var r = t[e.name],
                n = e.value;
            return Oe(e, t) && null !== n ? r >= n : null
        }, ve.lt = function(e, t) {
            var r = t[e.name],
                n = e.value;
            return Oe(e, t) && null !== n ? r < n : null
        }, ve.le = function(e, t) {
            var r = t[e.name],
                n = e.value;
            return Oe(e, t) && null !== n ? r <= n : null
        }, ve.substring = function(e, t) {
            var r = e.name,
                n = t[e.name],
                i = typeof n,
                o = e.value;
            return "string" != typeof o ? (Ee.warn(d.UNEXPECTED_CONDITION_VALUE, ge, JSON.stringify(e)), null) : null === n ? (Ee.debug(d.UNEXPECTED_TYPE_NULL, ge, JSON.stringify(e), r), null) : "string" != typeof n ? (Ee.warn(d.UNEXPECTED_TYPE, ge, JSON.stringify(e), i, r), null) : -1 !== n.indexOf(o)
        }, ve.semver_eq = function(e, t) {
            var r = Te(e, t);
            return null === r ? null : 0 === r
        }, ve.semver_gt = function(e, t) {
            var r = Te(e, t);
            return null === r ? null : r > 0
        }, ve.semver_ge = function(e, t) {
            var r = Te(e, t);
            return null === r ? null : r >= 0
        }, ve.semver_lt = function(e, t) {
            var r = Te(e, t);
            return null === r ? null : r < 0
        }, ve.semver_le = function(e, t) {
            var r = Te(e, t);
            return null === r ? null : r <= 0
        };
        var Re = Object.freeze({
                __proto__: null,
                evaluate: function(e, t) {
                    var r = e.match;
                    if (void 0 !== r && -1 === _e.indexOf(r)) return Ee.warn(d.UNKNOWN_MATCH_TYPE, ge, JSON.stringify(e)), null;
                    var n = e.name;
                    return t.hasOwnProperty(n) || "exists" == r ? (r && ve[r] || ye)(e, t) : (Ee.debug(d.MISSING_ATTRIBUTE_VALUE, ge, JSON.stringify(e), n), null)
                }
            }),
            Ae = i.getLogger(),
            Ne = function() {
                function e(e) {
                    this.typeToEvaluatorMap = x.assign({}, e, {
                        custom_attribute: Re
                    })
                }
                return e.prototype.evaluate = function(e, t, r) {
                    var n = this;
                    return void 0 === r && (r = {}), !e || 0 === e.length || !!k(e, (function(e) {
                        var i = t[e];
                        if (i) {
                            Ae.log(f.DEBUG, s.sprintf(d.EVALUATING_AUDIENCE, "AUDIENCE_EVALUATOR", e, JSON.stringify(i.conditions)));
                            var o = k(i.conditions, n.evaluateConditionWithUserAttributes.bind(n, r)),
                                a = null === o ? "UNKNOWN" : o.toString().toUpperCase();
                            return Ae.log(f.DEBUG, s.sprintf(d.AUDIENCE_EVALUATION_RESULT, "AUDIENCE_EVALUATOR", e, a)), o
                        }
                        return null
                    }))
                }, e.prototype.evaluateConditionWithUserAttributes = function(e, t) {
                    var r = this.typeToEvaluatorMap[t.type];
                    if (!r) return Ae.log(f.WARNING, s.sprintf(d.UNKNOWN_CONDITION_TYPE, "AUDIENCE_EVALUATOR", JSON.stringify(t))), null;
                    try {
                        return r.evaluate(t, e)
                    } catch (e) {
                        Ae.log(f.ERROR, s.sprintf(p.CONDITION_EVALUATOR_ERROR, "AUDIENCE_EVALUATOR", t.type, e.message))
                    }
                    return null
                }, e
            }();

        function me(e) {
            return "string" == typeof e && "" !== e
        }
        var Le = "DECISION_SERVICE",
            be = function() {
                function e(e) {
                    var t;
                    this.audienceEvaluator = (t = e.UNSTABLE_conditionEvaluators, new Ne(t)), this.forcedVariationMap = {}, this.logger = e.logger, this.userProfileService = e.userProfileService || null
                }
                return e.prototype.getVariation = function(e, r, n, i, o) {
                    void 0 === o && (o = {});
                    var a = this.getBucketingId(n, i),
                        u = [],
                        l = r.key;
                    if (!this.checkIfExperimentIsActive(e, l)) {
                        var c = s.sprintf(d.EXPERIMENT_NOT_RUNNING, Le, l);
                        return this.logger.log(f.INFO, c), u.push(c), {
                            result: null,
                            reasons: u
                        }
                    }
                    var p = this.getForcedVariation(e, l, n);
                    u.push.apply(u, p.reasons);
                    var h = p.result;
                    if (h) return {
                        result: h,
                        reasons: u
                    };
                    var g = this.getWhitelistedVariation(r, n);
                    u.push.apply(u, g.reasons);
                    var E = g.result;
                    if (E) return {
                        result: E.key,
                        reasons: u
                    };
                    var _ = o[t.OptimizelyDecideOption.IGNORE_USER_PROFILE_SERVICE],
                        v = this.resolveExperimentBucketMap(n, i);
                    if (!_ && (E = this.getStoredVariation(e, r, n, v))) {
                        var y = s.sprintf(d.RETURNING_STORED_VARIATION, Le, E.key, l, n);
                        return this.logger.log(f.INFO, y), u.push(y), {
                            result: E.key,
                            reasons: u
                        }
                    }
                    var O = this.checkIfUserIsInAudience(e, r, I.EXPERIMENT, i, "");
                    if (u.push.apply(u, O.reasons), !O.result) {
                        var T = s.sprintf(d.USER_NOT_IN_EXPERIMENT, Le, n, l);
                        return this.logger.log(f.INFO, T), u.push(T), {
                            result: null,
                            reasons: u
                        }
                    }
                    var R = this.buildBucketerParams(e, r, a, n),
                        A = se(R);
                    u.push.apply(u, A.reasons);
                    var N = A.result;
                    if (N && (E = e.variationIdMap[N]), !E) {
                        var m = s.sprintf(d.USER_HAS_NO_VARIATION, Le, n, l);
                        return this.logger.log(f.DEBUG, m), u.push(m), {
                            result: null,
                            reasons: u
                        }
                    }
                    var L = s.sprintf(d.USER_HAS_VARIATION, Le, n, E.key, l);
                    return this.logger.log(f.INFO, L), u.push(L), _ || this.saveUserProfile(r, E, n, v), {
                        result: E.key,
                        reasons: u
                    }
                }, e.prototype.resolveExperimentBucketMap = function(e, t) {
                    t = t || {};
                    var r = this.getUserProfile(e) || {},
                        n = t[h.STICKY_BUCKETING_KEY];
                    return x.assign({}, r.experiment_bucket_map, n)
                }, e.prototype.checkIfExperimentIsActive = function(e, t) {
                    return function(e, t) {
                        return "Running" === z(e, t)
                    }(e, t)
                }, e.prototype.getWhitelistedVariation = function(e, t) {
                    var r = [];
                    if (e.forcedVariations && e.forcedVariations.hasOwnProperty(t)) {
                        var n = e.forcedVariations[t];
                        if (e.variationKeyMap.hasOwnProperty(n)) {
                            var i = s.sprintf(d.USER_FORCED_IN_VARIATION, Le, t, n);
                            return this.logger.log(f.INFO, i), r.push(i), {
                                result: e.variationKeyMap[n],
                                reasons: r
                            }
                        }
                        var o = s.sprintf(d.FORCED_BUCKETING_FAILED, Le, n, t);
                        return this.logger.log(f.ERROR, o), r.push(o), {
                            result: null,
                            reasons: r
                        }
                    }
                    return {
                        result: null,
                        reasons: r
                    }
                }, e.prototype.checkIfUserIsInAudience = function(e, t, r, n, i) {
                    var o = [],
                        a = function(e, t) {
                            var r = e.experimentIdMap[t];
                            if (!r) throw new Error(s.sprintf(p.INVALID_EXPERIMENT_ID, G, t));
                            return r.audienceConditions || r.audienceIds
                        }(e, t.id),
                        u = e.audiencesById,
                        l = s.sprintf(d.EVALUATING_AUDIENCES_COMBINED, Le, r, i || t.key, JSON.stringify(a));
                    this.logger.log(f.DEBUG, l), o.push(l);
                    var c = this.audienceEvaluator.evaluate(a, u, n),
                        h = s.sprintf(d.AUDIENCE_EVALUATION_RESULT_COMBINED, Le, r, i || t.key, c.toString().toUpperCase());
                    return this.logger.log(f.INFO, h), o.push(h), {
                        result: c,
                        reasons: o
                    }
                }, e.prototype.buildBucketerParams = function(e, t, r, n) {
                    return {
                        bucketingId: r,
                        experimentId: t.id,
                        experimentKey: t.key,
                        experimentIdMap: e.experimentIdMap,
                        experimentKeyMap: e.experimentKeyMap,
                        groupIdMap: e.groupIdMap,
                        logger: this.logger,
                        trafficAllocationConfig: W(e, t.id),
                        userId: n,
                        variationIdMap: e.variationIdMap
                    }
                }, e.prototype.getStoredVariation = function(e, t, r, n) {
                    if (n.hasOwnProperty(t.id)) {
                        var i = n[t.id],
                            o = i.variation_id;
                        if (e.variationIdMap.hasOwnProperty(o)) return e.variationIdMap[i.variation_id];
                        this.logger.log(f.INFO, s.sprintf(d.SAVED_VARIATION_NOT_FOUND, Le, r, o, t.key))
                    }
                    return null
                }, e.prototype.getUserProfile = function(e) {
                    var t = {
                        user_id: e,
                        experiment_bucket_map: {}
                    };
                    if (!this.userProfileService) return t;
                    try {
                        return this.userProfileService.lookup(e)
                    } catch (t) {
                        this.logger.log(f.ERROR, s.sprintf(p.USER_PROFILE_LOOKUP_ERROR, Le, e, t.message))
                    }
                    return null
                }, e.prototype.saveUserProfile = function(e, t, r, n) {
                    if (this.userProfileService) try {
                        n[e.id] = {
                            variation_id: t.id
                        }, this.userProfileService.save({
                            user_id: r,
                            experiment_bucket_map: n
                        }), this.logger.log(f.INFO, s.sprintf(d.SAVED_VARIATION, Le, t.key, e.key, r))
                    } catch (e) {
                        this.logger.log(f.ERROR, s.sprintf(p.USER_PROFILE_SAVE_ERROR, Le, r, e.message))
                    }
                }, e.prototype.getVariationForFeature = function(e, t, r, n, i) {
                    void 0 === i && (i = {});
                    var o = [],
                        a = this.getVariationForFeatureExperiment(e, t, r, n, i);
                    o.push.apply(o, a.reasons);
                    var u = a.result;
                    if (null !== u.variation) return {
                        result: u,
                        reasons: o
                    };
                    var l = this.getVariationForRollout(e, t, r, n);
                    o.push.apply(o, l.reasons);
                    var c = l.result;
                    if (c.variation) {
                        var p = s.sprintf(d.USER_IN_ROLLOUT, Le, r, t.key);
                        return this.logger.log(f.DEBUG, p), o.push(p), {
                            result: c,
                            reasons: o
                        }
                    }
                    var h = s.sprintf(d.USER_NOT_IN_ROLLOUT, Le, r, t.key);
                    return this.logger.log(f.DEBUG, h), o.push(h), {
                        result: c,
                        reasons: o
                    }
                }, e.prototype.getVariationForFeatureExperiment = function(e, t, r, n, i) {
                    void 0 === i && (i = {});
                    var o, a, u = [],
                        l = null;
                    if (t.experimentIds.length > 0)
                        for (a = 0; a < t.experimentIds.length; a++) {
                            var c = Z(e, t.experimentIds[a], this.logger);
                            if (c && (o = this.getVariation(e, c, r, n, i), u.push.apply(u, o.reasons), l = o.result)) return {
                                result: {
                                    experiment: c,
                                    variation: c.variationKeyMap[l],
                                    decisionSource: v.FEATURE_TEST
                                },
                                reasons: u
                            }
                        } else {
                            var p = s.sprintf(d.FEATURE_HAS_NO_EXPERIMENTS, Le, t.key);
                            this.logger.log(f.DEBUG, p), u.push(p)
                        }
                    return {
                        result: {
                            experiment: null,
                            variation: null,
                            decisionSource: v.FEATURE_TEST
                        },
                        reasons: u
                    }
                }, e.prototype.getVariationForRollout = function(e, t, r, n) {
                    var i = [];
                    if (!t.rolloutId) {
                        var o = s.sprintf(d.NO_ROLLOUT_EXISTS, Le, t.key);
                        return this.logger.log(f.DEBUG, o), i.push(o), {
                            result: {
                                experiment: null,
                                variation: null,
                                decisionSource: v.ROLLOUT
                            },
                            reasons: i
                        }
                    }
                    var a = e.rolloutIdMap[t.rolloutId];
                    if (!a) {
                        var u = s.sprintf(p.INVALID_ROLLOUT_ID, Le, t.rolloutId, t.key);
                        return this.logger.log(f.ERROR, u), i.push(u), {
                            result: {
                                experiment: null,
                                variation: null,
                                decisionSource: v.ROLLOUT
                            },
                            reasons: i
                        }
                    }
                    if (0 === a.experiments.length) {
                        var l = s.sprintf(d.ROLLOUT_HAS_NO_EXPERIMENTS, Le, t.rolloutId);
                        return this.logger.log(f.ERROR, l), i.push(l), {
                            result: {
                                experiment: null,
                                variation: null,
                                decisionSource: v.ROLLOUT
                            },
                            reasons: i
                        }
                    }
                    for (var c, h, g, E, _, y, O, T = this.getBucketingId(r, n), R = a.experiments.length - 1, A = 0; A < R; A++) {
                        if (c = e.experimentIdMap[a.experiments[A].id], _ = A + 1, O = this.checkIfUserIsInAudience(e, c, I.RULE, n, _), i.push.apply(i, O.reasons), O.result) {
                            var N = s.sprintf(d.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE, Le, r, _);
                            if (this.logger.log(f.DEBUG, N), i.push(N), h = this.buildBucketerParams(e, c, T, r), y = se(h), i.push.apply(i, y.reasons), (g = y.result) && (E = e.variationIdMap[g]), E) {
                                var m = s.sprintf(d.USER_BUCKETED_INTO_TARGETING_RULE, Le, r, _);
                                return this.logger.log(f.DEBUG, m), i.push(m), {
                                    result: {
                                        experiment: c,
                                        variation: E,
                                        decisionSource: v.ROLLOUT
                                    },
                                    reasons: i
                                }
                            }
                            var L = s.sprintf(d.USER_NOT_BUCKETED_INTO_TARGETING_RULE, Le, r, _);
                            this.logger.log(f.DEBUG, L), i.push(L);
                            break
                        }
                        var b = s.sprintf(d.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE, Le, r, _);
                        this.logger.log(f.DEBUG, b), i.push(b)
                    }
                    var U = e.experimentKeyMap[a.experiments[R].key],
                        S = this.checkIfUserIsInAudience(e, U, I.RULE, n, "Everyone Else");
                    if (i.push.apply(i, S.reasons), S.result) {
                        var D = s.sprintf(d.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE, Le, r, "Everyone Else");
                        if (this.logger.log(f.DEBUG, D), i.push(D), h = this.buildBucketerParams(e, U, T, r), y = se(h), i.push.apply(i, y.reasons), (g = y.result) && (E = e.variationIdMap[g]), E) {
                            var C = s.sprintf(d.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE, Le, r);
                            return this.logger.log(f.DEBUG, C), i.push(C), {
                                result: {
                                    experiment: U,
                                    variation: E,
                                    decisionSource: v.ROLLOUT
                                },
                                reasons: i
                            }
                        }
                        var V = s.sprintf(d.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE, Le, r);
                        this.logger.log(f.DEBUG, V), i.push(V)
                    }
                    return {
                        result: {
                            experiment: null,
                            variation: null,
                            decisionSource: v.ROLLOUT
                        },
                        reasons: i
                    }
                }, e.prototype.getBucketingId = function(e, t) {
                    var r = e;
                    return null != t && "object" == typeof t && t.hasOwnProperty(h.BUCKETING_ID) && ("string" == typeof t[h.BUCKETING_ID] ? (r = t[h.BUCKETING_ID], this.logger.log(f.DEBUG, s.sprintf(d.VALID_BUCKETING_ID, Le, r))) : this.logger.log(f.WARNING, s.sprintf(d.BUCKETING_ID_NOT_STRING, Le))), r
                }, e.prototype.removeForcedVariation = function(e, t, r) {
                    if (!e) throw new Error(s.sprintf(p.INVALID_USER_ID, Le));
                    if (!this.forcedVariationMap.hasOwnProperty(e)) throw new Error(s.sprintf(p.USER_NOT_IN_FORCED_VARIATION, Le, e));
                    delete this.forcedVariationMap[e][t], this.logger.log(f.DEBUG, s.sprintf(d.VARIATION_REMOVED_FOR_USER, Le, r, e))
                }, e.prototype.setInForcedVariationMap = function(e, t, r) {
                    this.forcedVariationMap.hasOwnProperty(e) || (this.forcedVariationMap[e] = {}), this.forcedVariationMap[e][t] = r, this.logger.log(f.DEBUG, s.sprintf(d.USER_MAPPED_TO_FORCED_VARIATION, Le, r, t, e))
                }, e.prototype.getForcedVariation = function(e, t, r) {
                    var n, i = [],
                        o = this.forcedVariationMap[r];
                    if (!o) return this.logger.log(f.DEBUG, s.sprintf(d.USER_HAS_NO_FORCED_VARIATION, Le, r)), {
                        result: null,
                        reasons: i
                    };
                    try {
                        var a = X(e, t);
                        if (!a.hasOwnProperty("id")) {
                            var u = s.sprintf(p.IMPROPERLY_FORMATTED_EXPERIMENT, Le, t);
                            return this.logger.log(f.ERROR, u), i.push(u), {
                                result: null,
                                reasons: i
                            }
                        }
                        n = a.id
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), i.push(e.message), {
                            result: null,
                            reasons: i
                        }
                    }
                    var l = o[n];
                    if (!l) return this.logger.log(f.DEBUG, s.sprintf(d.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT, Le, t, r)), {
                        result: null,
                        reasons: i
                    };
                    var c = J(e, l);
                    if (c) {
                        var h = s.sprintf(d.USER_HAS_FORCED_VARIATION, Le, c, t, r);
                        this.logger.log(f.DEBUG, h), i.push(h)
                    } else this.logger.log(f.DEBUG, s.sprintf(d.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT, Le, t, r));
                    return {
                        result: c,
                        reasons: i
                    }
                }, e.prototype.setForcedVariation = function(e, t, r, n) {
                    if (null != n && !me(n)) return this.logger.log(f.ERROR, s.sprintf(p.INVALID_VARIATION_KEY, Le)), !1;
                    var i;
                    try {
                        var o = X(e, t);
                        if (!o.hasOwnProperty("id")) return this.logger.log(f.ERROR, s.sprintf(p.IMPROPERLY_FORMATTED_EXPERIMENT, Le, t)), !1;
                        i = o.id
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), !1
                    }
                    if (null == n) try {
                        return this.removeForcedVariation(r, i, t), !0
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), !1
                    }
                    var a = function(e, t, r) {
                        var n = e.experimentKeyMap[t];
                        return n.variationKeyMap.hasOwnProperty(r) ? n.variationKeyMap[r].id : null
                    }(e, t, n);
                    if (!a) return this.logger.log(f.ERROR, s.sprintf(p.NO_VARIATION_FOR_EXPERIMENT_KEY, Le, n, t)), !1;
                    try {
                        return this.setInForcedVariationMap(r, i, a), !0
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), !1
                    }
                }, e
            }();

        function Ue(e, t) {
            if (e.hasOwnProperty("revenue")) {
                var r = e.revenue,
                    n = void 0;
                return "string" == typeof r ? (n = parseInt(r), isNaN(n) ? (t.log(f.INFO, s.sprintf(d.FAILED_TO_PARSE_REVENUE, "EVENT_TAG_UTILS", r)), null) : (t.log(f.INFO, s.sprintf(d.PARSED_REVENUE_VALUE, "EVENT_TAG_UTILS", n)), n)) : "number" == typeof r ? (n = r, t.log(f.INFO, s.sprintf(d.PARSED_REVENUE_VALUE, "EVENT_TAG_UTILS", n)), n) : null
            }
            return null
        }

        function Se(e, t) {
            if (e.hasOwnProperty("value")) {
                var r = e.value,
                    n = void 0;
                return "string" == typeof r ? (n = parseFloat(r), isNaN(n) ? (t.log(f.INFO, s.sprintf(d.FAILED_TO_PARSE_VALUE, "EVENT_TAG_UTILS", r)), null) : (t.log(f.INFO, s.sprintf(d.PARSED_NUMERIC_VALUE, "EVENT_TAG_UTILS", n)), n)) : "number" == typeof r ? (n = r, t.log(f.INFO, s.sprintf(d.PARSED_NUMERIC_VALUE, "EVENT_TAG_UTILS", n)), n) : null
            }
            return null
        }

        function De(e, t) {
            return "string" == typeof e && ("string" == typeof t || "boolean" == typeof t || x.isNumber(t) && x.isSafeInteger(t))
        }
        var Ce = "https://logx.optimizely.com/v1/events";

        function Ve(e) {
            var t = e.attributes,
                r = e.userId,
                n = e.clientEngine,
                i = e.clientVersion,
                o = e.configObj,
                s = e.logger,
                a = !!o.anonymizeIP && o.anonymizeIP,
                u = o.botFiltering,
                l = {
                    snapshots: [],
                    visitor_id: r,
                    attributes: []
                },
                c = {
                    account_id: o.accountId,
                    project_id: o.projectId,
                    visitors: [l],
                    revision: o.revision,
                    client_name: n,
                    client_version: i,
                    anonymize_ip: a,
                    enrich_decisions: !0
                };
            return t && Object.keys(t || {}).forEach((function(e) {
                if (De(e, t[e])) {
                    var r = Y(o, e, s);
                    r && c.visitors[0].attributes.push({
                        entity_id: r,
                        key: e,
                        type: "custom",
                        value: t[e]
                    })
                }
            })), "boolean" == typeof u && c.visitors[0].attributes.push({
                entity_id: h.BOT_FILTERING,
                key: h.BOT_FILTERING,
                type: "custom",
                value: u
            }), c
        }

        function Pe(e) {
            var t, r;
            return null !== (r = null === (t = e.experiment) || void 0 === t ? void 0 : t.key) && void 0 !== r ? r : ""
        }

        function Fe(e) {
            var t, r;
            return null !== (r = null === (t = e.variation) || void 0 === t ? void 0 : t.key) && void 0 !== r ? r : ""
        }

        function Me(e) {
            var t, r;
            return null !== (r = null === (t = e.variation) || void 0 === t ? void 0 : t.featureEnabled) && void 0 !== r && r
        }

        function xe(e) {
            var t, r;
            return null !== (r = null === (t = e.experiment) || void 0 === t ? void 0 : t.id) && void 0 !== r ? r : null
        }
        var we = i.getLogger("EVENT_BUILDER");

        function ke(e, t) {
            var r = [];
            return t && Object.keys(t || {}).forEach((function(n) {
                if (De(n, t[n])) {
                    var i = Y(e, n, we);
                    i && r.push({
                        entityId: i,
                        key: n,
                        value: t[n]
                    })
                }
            })), r
        }
        var Be = function() {
                for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                return new(o.LogTierV1EventProcessor.bind.apply(o.LogTierV1EventProcessor, c([void 0], e)))
            },
            Ge = (o.LocalStoragePendingEventsDispatcher, "USER_PROFILE_SERVICE_VALIDATOR"),
            je = function() {
                function e(e) {
                    var r, n = this,
                        i = e.clientEngine; - 1 === g.indexOf(i) && (e.logger.log(f.INFO, s.sprintf(d.INVALID_CLIENT_ENGINE, "OPTIMIZELY", i)), i = "node-sdk"), this.clientEngine = i, this.clientVersion = e.clientVersion || "4.7.0", this.errorHandler = e.errorHandler, this.eventDispatcher = e.eventDispatcher, this.isOptimizelyConfigValid = e.isValidInstance, this.logger = e.logger;
                    var o = null !== (r = e.defaultDecideOptions) && void 0 !== r ? r : [];
                    Array.isArray(o) || (this.logger.log(f.DEBUG, s.sprintf(d.INVALID_DEFAULT_DECIDE_OPTIONS, "OPTIMIZELY")), o = []);
                    var a = {};
                    o.forEach((function(e) {
                        t.OptimizelyDecideOption[e] ? a[e] = !0 : n.logger.log(f.WARNING, s.sprintf(d.UNRECOGNIZED_DECIDE_OPTION, "OPTIMIZELY", e))
                    })), this.defaultDecideOptions = a, this.projectConfigManager = function(e) {
                        return new ne(e)
                    }({
                        datafile: e.datafile,
                        datafileOptions: e.datafileOptions,
                        jsonSchemaValidator: e.jsonSchemaValidator,
                        sdkKey: e.sdkKey
                    }), this.disposeOnUpdate = this.projectConfigManager.onUpdate((function(e) {
                        n.logger.log(f.INFO, s.sprintf(d.UPDATED_OPTIMIZELY_CONFIG, "OPTIMIZELY", e.revision, e.projectId)), n.notificationCenter.sendNotifications(E.OPTIMIZELY_CONFIG_UPDATE)
                    }));
                    var u, l = this.projectConfigManager.onReady(),
                        c = null;
                    if (e.userProfileService) try {
                        (function(e) {
                            if ("object" == typeof e && null !== e) {
                                if ("function" != typeof e.lookup) throw new Error(s.sprintf(p.INVALID_USER_PROFILE_SERVICE, Ge, "Missing function 'lookup'"));
                                if ("function" != typeof e.save) throw new Error(s.sprintf(p.INVALID_USER_PROFILE_SERVICE, Ge, "Missing function 'save'"));
                                return !0
                            }
                            throw new Error(s.sprintf(p.INVALID_USER_PROFILE_SERVICE, Ge))
                        })(e.userProfileService) && (c = e.userProfileService, this.logger.log(f.INFO, s.sprintf(d.VALID_USER_PROFILE_SERVICE, "OPTIMIZELY")))
                    } catch (e) {
                        this.logger.log(f.WARNING, e.message)
                    }
                    this.decisionService = (u = {
                        userProfileService: c,
                        logger: this.logger,
                        UNSTABLE_conditionEvaluators: e.UNSTABLE_conditionEvaluators
                    }, new be(u)), this.notificationCenter = function(e) {
                        return new ie(e)
                    }({
                        logger: this.logger,
                        errorHandler: this.errorHandler
                    });
                    var h = {
                        dispatcher: this.eventDispatcher,
                        flushInterval: e.eventFlushInterval,
                        batchSize: e.eventBatchSize,
                        maxQueueSize: e.eventMaxQueueSize,
                        notificationCenter: this.notificationCenter
                    };
                    this.eventProcessor = Be(h);
                    var _ = this.eventProcessor.start();
                    this.readyPromise = Promise.all([l, _]).then((function(e) {
                        return e[0]
                    })), this.readyTimeouts = {}, this.nextReadyTimeoutId = 0
                }
                return e.prototype.isValidInstance = function() {
                    return this.isOptimizelyConfigValid && !!this.projectConfigManager.getConfig()
                }, e.prototype.activate = function(e, t, r) {
                    try {
                        if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "activate")), null;
                        if (!this.validateInputs({
                                experiment_key: e,
                                user_id: t
                            }, r)) return this.notActivatingExperiment(e, t);
                        var n = this.projectConfigManager.getConfig();
                        if (!n) return null;
                        try {
                            var i = this.getVariation(e, t, r);
                            if (null === i) return this.notActivatingExperiment(e, t);
                            if (! function(e, t) {
                                    return "Running" === z(e, t)
                                }(n, e)) {
                                var o = s.sprintf(d.SHOULD_NOT_DISPATCH_ACTIVATE, "OPTIMIZELY", e);
                                return this.logger.log(f.DEBUG, o), i
                            }
                            var a = X(n, e),
                                u = {
                                    experiment: a,
                                    variation: a.variationKeyMap[i],
                                    decisionSource: v.EXPERIMENT
                                };
                            return this.sendImpressionEvent(u, "", t, !0, r), i
                        } catch (r) {
                            this.logger.log(f.ERROR, r.message);
                            var l = s.sprintf(d.NOT_ACTIVATING_USER, "OPTIMIZELY", t, e);
                            return this.logger.log(f.INFO, l), this.errorHandler.handleError(r), null
                        }
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.sendImpressionEvent = function(e, t, r, n, i) {
                    var o = this.projectConfigManager.getConfig();
                    if (o) {
                        var s = function(e) {
                            var t = e.configObj,
                                r = e.decisionObj,
                                n = e.userId,
                                i = e.flagKey,
                                o = e.enabled,
                                s = e.userAttributes,
                                a = e.clientEngine,
                                u = e.clientVersion,
                                l = r.decisionSource,
                                c = Pe(r),
                                f = xe(r),
                                p = Fe(r),
                                d = null !== f && "" !== p ? q(t, f, p) : null,
                                h = null !== f ? K(t, f) : null;
                            return {
                                type: "impression",
                                timestamp: x.currentTimestamp(),
                                uuid: x.uuid(),
                                user: {
                                    id: n,
                                    attributes: ke(t, s)
                                },
                                context: {
                                    accountId: t.accountId,
                                    projectId: t.projectId,
                                    revision: t.revision,
                                    clientName: a,
                                    clientVersion: u,
                                    anonymizeIP: t.anonymizeIP || !1,
                                    botFiltering: t.botFiltering
                                },
                                layer: {
                                    id: h
                                },
                                experiment: {
                                    id: f,
                                    key: c
                                },
                                variation: {
                                    id: d,
                                    key: p
                                },
                                ruleKey: c,
                                flagKey: i,
                                ruleType: l,
                                enabled: o
                            }
                        }({
                            decisionObj: e,
                            flagKey: t,
                            enabled: n,
                            userId: r,
                            userAttributes: i,
                            clientEngine: this.clientEngine,
                            clientVersion: this.clientVersion,
                            configObj: o
                        });
                        this.eventProcessor.process(s), this.emitNotificationCenterActivate(e, t, r, n, i)
                    }
                }, e.prototype.emitNotificationCenterActivate = function(e, t, r, n, i) {
                    var o = this.projectConfigManager.getConfig();
                    if (o) {
                        var s, a = e.decisionSource,
                            u = Pe(e),
                            l = xe(e),
                            c = Fe(e),
                            f = null;
                        null !== l && "" !== c && (f = q(o, l, c), s = o.experimentIdMap[l]);
                        var p, d = function(e) {
                            var t, r, n, i, o, s, a, u, l = Ve(e),
                                c = (t = e.configObj, n = e.variationId, i = e.ruleKey, o = e.ruleType, s = e.flagKey, a = e.enabled, {
                                    decisions: [{
                                        campaign_id: u = (r = e.experimentId) ? K(t, r) : null,
                                        experiment_id: r,
                                        variation_id: n,
                                        metadata: {
                                            flag_key: s,
                                            rule_key: i,
                                            rule_type: o,
                                            variation_key: (n ? J(t, n) : null) || "",
                                            enabled: a
                                        }
                                    }],
                                    events: [{
                                        entity_id: u,
                                        timestamp: x.currentTimestamp(),
                                        key: "campaign_activated",
                                        uuid: x.uuid()
                                    }]
                                });
                            return l.visitors[0].snapshots.push(c), {
                                httpVerb: "POST",
                                url: Ce,
                                params: l
                            }
                        }({
                            attributes: i,
                            clientEngine: this.clientEngine,
                            clientVersion: this.clientVersion,
                            configObj: o,
                            experimentId: l,
                            ruleKey: u,
                            flagKey: t,
                            ruleType: a,
                            userId: r,
                            enabled: n,
                            variationId: f,
                            logger: this.logger
                        });
                        s && s.variationKeyMap && "" !== c && (p = s.variationKeyMap[c]), this.notificationCenter.sendNotifications(E.ACTIVATE, {
                            experiment: s,
                            userId: r,
                            attributes: i,
                            variation: p,
                            logEvent: d
                        })
                    }
                }, e.prototype.track = function(e, t, r, n) {
                    try {
                        if (!this.isValidInstance()) return void this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "track"));
                        if (!this.validateInputs({
                                user_id: t,
                                event_key: e
                            }, r, n)) return;
                        var i = this.projectConfigManager.getConfig();
                        if (!i) return;
                        if (! function(e, t) {
                                return e.eventKeyMap.hasOwnProperty(t)
                            }(i, e)) return this.logger.log(f.WARNING, s.sprintf(d.EVENT_KEY_NOT_FOUND, "OPTIMIZELY", e)), void this.logger.log(f.WARNING, s.sprintf(d.NOT_TRACKING_USER, "OPTIMIZELY", t));
                        var o = function(e) {
                            var t = e.configObj,
                                r = e.userId,
                                n = e.userAttributes,
                                i = e.clientEngine,
                                o = e.clientVersion,
                                s = e.eventKey,
                                a = e.eventTags,
                                u = H(t, s),
                                l = a ? Ue(a, we) : null,
                                c = a ? Se(a, we) : null;
                            return {
                                type: "conversion",
                                timestamp: x.currentTimestamp(),
                                uuid: x.uuid(),
                                user: {
                                    id: r,
                                    attributes: ke(t, n)
                                },
                                context: {
                                    accountId: t.accountId,
                                    projectId: t.projectId,
                                    revision: t.revision,
                                    clientName: i,
                                    clientVersion: o,
                                    anonymizeIP: t.anonymizeIP || !1,
                                    botFiltering: t.botFiltering
                                },
                                event: {
                                    id: u,
                                    key: s
                                },
                                revenue: l,
                                value: c,
                                tags: a
                            }
                        }({
                            eventKey: e,
                            eventTags: n = this.filterEmptyValues(n),
                            userId: t,
                            userAttributes: r,
                            clientEngine: this.clientEngine,
                            clientVersion: this.clientVersion,
                            configObj: i
                        });
                        this.logger.log(f.INFO, s.sprintf(d.TRACK_EVENT, "OPTIMIZELY", e, t)), this.eventProcessor.process(o), this.emitNotificationCenterTrack(e, t, r, n)
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e);
                        var a = s.sprintf(d.NOT_TRACKING_USER, "OPTIMIZELY", t);
                        this.logger.log(f.ERROR, a)
                    }
                }, e.prototype.emitNotificationCenterTrack = function(e, t, r, n) {
                    try {
                        var i = this.projectConfigManager.getConfig();
                        if (!i) return;
                        var o = function(e) {
                            var t = Ve(e),
                                r = function(e, t, r, n) {
                                    var i = {
                                            events: []
                                        },
                                        o = {
                                            entity_id: H(e, t),
                                            timestamp: x.currentTimestamp(),
                                            uuid: x.uuid(),
                                            key: t
                                        };
                                    if (n) {
                                        var s = Ue(n, r);
                                        null !== s && (o.revenue = s);
                                        var a = Se(n, r);
                                        null !== a && (o.value = a), o.tags = n
                                    }
                                    return i.events.push(o), i
                                }(e.configObj, e.eventKey, e.logger, e.eventTags);
                            return t.visitors[0].snapshots = [r], {
                                httpVerb: "POST",
                                url: Ce,
                                params: t
                            }
                        }({
                            attributes: r,
                            clientEngine: this.clientEngine,
                            clientVersion: this.clientVersion,
                            configObj: i,
                            eventKey: e,
                            eventTags: n,
                            logger: this.logger,
                            userId: t
                        });
                        this.notificationCenter.sendNotifications(E.TRACK, {
                            eventKey: e,
                            userId: t,
                            attributes: r,
                            eventTags: n,
                            logEvent: o
                        })
                    } catch (e) {
                        this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e)
                    }
                }, e.prototype.getVariation = function(e, t, r) {
                    try {
                        if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getVariation")), null;
                        try {
                            if (!this.validateInputs({
                                    experiment_key: e,
                                    user_id: t
                                }, r)) return null;
                            var n = this.projectConfigManager.getConfig();
                            if (!n) return null;
                            var i = n.experimentKeyMap[e];
                            if (!i) return this.logger.log(f.DEBUG, s.sprintf(p.INVALID_EXPERIMENT_KEY, "OPTIMIZELY", e)), null;
                            var o = this.decisionService.getVariation(n, i, t, r).result,
                                a = (u = n, l = i.id, u.experimentFeatureMap.hasOwnProperty(l) ? _.FEATURE_TEST : _.AB_TEST);
                            return this.notificationCenter.sendNotifications(E.DECISION, {
                                type: a,
                                userId: t,
                                attributes: r || {},
                                decisionInfo: {
                                    experimentKey: e,
                                    variationKey: o
                                }
                            }), o
                        } catch (e) {
                            return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                        }
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                    var u, l
                }, e.prototype.setForcedVariation = function(e, t, r) {
                    if (!this.validateInputs({
                            experiment_key: e,
                            user_id: t
                        })) return !1;
                    var n = this.projectConfigManager.getConfig();
                    if (!n) return !1;
                    try {
                        return this.decisionService.setForcedVariation(n, e, t, r)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), !1
                    }
                }, e.prototype.getForcedVariation = function(e, t) {
                    if (!this.validateInputs({
                            experiment_key: e,
                            user_id: t
                        })) return null;
                    var r = this.projectConfigManager.getConfig();
                    if (!r) return null;
                    try {
                        return this.decisionService.getForcedVariation(r, e, t).result
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.validateInputs = function(e, t, r) {
                    try {
                        if (e.hasOwnProperty("user_id")) {
                            var n = e.user_id;
                            if ("string" != typeof n || null === n || "undefined" === n) throw new Error(s.sprintf(p.INVALID_INPUT_FORMAT, "OPTIMIZELY", "user_id"));
                            delete e.user_id
                        }
                        return Object.keys(e).forEach((function(t) {
                            if (!me(e[t])) throw new Error(s.sprintf(p.INVALID_INPUT_FORMAT, "OPTIMIZELY", t))
                        })), t && function(e) {
                            if ("object" != typeof e || Array.isArray(e) || null === e) throw new Error(s.sprintf(p.INVALID_ATTRIBUTES, "ATTRIBUTES_VALIDATOR"));
                            Object.keys(e).forEach((function(t) {
                                if (void 0 === e[t]) throw new Error(s.sprintf(p.UNDEFINED_ATTRIBUTE, "ATTRIBUTES_VALIDATOR", t))
                            }))
                        }(t), r && function(e) {
                            if ("object" != typeof e || Array.isArray(e) || null === e) throw new Error(s.sprintf(p.INVALID_EVENT_TAGS, "EVENT_TAGS_VALIDATOR"))
                        }(r), !0
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), !1
                    }
                }, e.prototype.notActivatingExperiment = function(e, t) {
                    var r = s.sprintf(d.NOT_ACTIVATING_USER, "OPTIMIZELY", t, e);
                    return this.logger.log(f.INFO, r), null
                }, e.prototype.filterEmptyValues = function(e) {
                    for (var t in e) !e.hasOwnProperty(t) || null !== e[t] && void 0 !== e[t] || delete e[t];
                    return e
                }, e.prototype.isFeatureEnabled = function(e, t, r) {
                    try {
                        if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "isFeatureEnabled")), !1;
                        if (!this.validateInputs({
                                feature_key: e,
                                user_id: t
                            }, r)) return !1;
                        var n = this.projectConfigManager.getConfig();
                        if (!n) return !1;
                        var i = $(n, e, this.logger);
                        if (!i) return !1;
                        var o = {},
                            a = this.decisionService.getVariationForFeature(n, i, t, r).result,
                            u = a.decisionSource,
                            l = Pe(a),
                            c = Fe(a),
                            p = Me(a);
                        u === v.FEATURE_TEST && (o = {
                            experimentKey: l,
                            variationKey: c
                        }), (u === v.FEATURE_TEST || u === v.ROLLOUT && ee(n)) && this.sendImpressionEvent(a, i.key, t, p, r), !0 === p ? this.logger.log(f.INFO, s.sprintf(d.FEATURE_ENABLED_FOR_USER, "OPTIMIZELY", e, t)) : (this.logger.log(f.INFO, s.sprintf(d.FEATURE_NOT_ENABLED_FOR_USER, "OPTIMIZELY", e, t)), p = !1);
                        var h = {
                            featureKey: e,
                            featureEnabled: p,
                            source: a.decisionSource,
                            sourceInfo: o
                        };
                        return this.notificationCenter.sendNotifications(E.DECISION, {
                            type: _.FEATURE,
                            userId: t,
                            attributes: r || {},
                            decisionInfo: h
                        }), p
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), !1
                    }
                }, e.prototype.getEnabledFeatures = function(e, t) {
                    var r = this;
                    try {
                        var n = [];
                        if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getEnabledFeatures")), n;
                        if (!this.validateInputs({
                                user_id: e
                            })) return n;
                        var i = this.projectConfigManager.getConfig();
                        return i ? (s.objectValues(i.featureKeyMap).forEach((function(i) {
                            r.isFeatureEnabled(i.key, e, t) && n.push(i.key)
                        })), n) : n
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), []
                    }
                }, e.prototype.getFeatureVariable = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, null, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariable")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getFeatureVariableForType = function(e, t, r, n, i) {
                    if (!this.validateInputs({
                            feature_key: e,
                            variable_key: t,
                            user_id: n
                        }, i)) return null;
                    var o = this.projectConfigManager.getConfig();
                    if (!o) return null;
                    var a = $(o, e, this.logger);
                    if (!a) return null;
                    var u = function(e, t, r, n) {
                        var i = e.featureKeyMap[t];
                        return i ? i.variableKeyMap[r] || (n.log(f.ERROR, s.sprintf(p.VARIABLE_KEY_NOT_IN_DATAFILE, G, r, t)), null) : (n.log(f.ERROR, s.sprintf(p.FEATURE_NOT_IN_DATAFILE, G, t)), null)
                    }(o, e, t, this.logger);
                    if (!u) return null;
                    if (r && u.type !== r) return this.logger.log(f.WARNING, s.sprintf(d.VARIABLE_REQUESTED_WITH_WRONG_TYPE, "OPTIMIZELY", r, u.type)), null;
                    var l = this.decisionService.getVariationForFeature(o, a, n, i).result,
                        c = Me(l),
                        h = this.getFeatureVariableValueFromVariation(e, c, l.variation, u, n),
                        g = {};
                    return l.decisionSource === v.FEATURE_TEST && null !== l.experiment && null !== l.variation && (g = {
                        experimentKey: l.experiment.key,
                        variationKey: l.variation.key
                    }), this.notificationCenter.sendNotifications(E.DECISION, {
                        type: _.FEATURE_VARIABLE,
                        userId: n,
                        attributes: i || {},
                        decisionInfo: {
                            featureKey: e,
                            featureEnabled: c,
                            source: l.decisionSource,
                            variableKey: t,
                            variableValue: h,
                            variableType: u.type,
                            sourceInfo: g
                        }
                    }), h
                }, e.prototype.getFeatureVariableValueFromVariation = function(e, t, r, n, i) {
                    var o = this.projectConfigManager.getConfig();
                    if (!o) return null;
                    var a = n.defaultValue;
                    if (null !== r) {
                        var u = function(e, t, r, n) {
                            if (!t || !r) return null;
                            if (!e.variationVariableUsageMap.hasOwnProperty(r.id)) return n.log(f.ERROR, s.sprintf(p.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT, G, r.id)), null;
                            var i = e.variationVariableUsageMap[r.id][t.id];
                            return i ? i.value : null
                        }(o, n, r, this.logger);
                        null !== u ? t ? (a = u, this.logger.log(f.INFO, s.sprintf(d.USER_RECEIVED_VARIABLE_VALUE, "OPTIMIZELY", a, n.key, e))) : this.logger.log(f.INFO, s.sprintf(d.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE, "OPTIMIZELY", e, i, a)) : this.logger.log(f.INFO, s.sprintf(d.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE, "OPTIMIZELY", n.key, r.key))
                    } else this.logger.log(f.INFO, s.sprintf(d.USER_RECEIVED_DEFAULT_VARIABLE_VALUE, "OPTIMIZELY", i, n.key, e));
                    return function(e, t, r) {
                        var n;
                        switch (t) {
                            case y.BOOLEAN:
                                "true" !== e && "false" !== e ? (r.log(f.ERROR, s.sprintf(p.UNABLE_TO_CAST_VALUE, G, e, t)), n = null) : n = "true" === e;
                                break;
                            case y.INTEGER:
                                n = parseInt(e, 10), isNaN(n) && (r.log(f.ERROR, s.sprintf(p.UNABLE_TO_CAST_VALUE, G, e, t)), n = null);
                                break;
                            case y.DOUBLE:
                                n = parseFloat(e), isNaN(n) && (r.log(f.ERROR, s.sprintf(p.UNABLE_TO_CAST_VALUE, G, e, t)), n = null);
                                break;
                            case y.JSON:
                                try {
                                    n = JSON.parse(e)
                                } catch (i) {
                                    r.log(f.ERROR, s.sprintf(p.UNABLE_TO_CAST_VALUE, G, e, t)), n = null
                                }
                                break;
                            default:
                                n = e
                        }
                        return n
                    }(a, n.type, this.logger)
                }, e.prototype.getFeatureVariableBoolean = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, y.BOOLEAN, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariableBoolean")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getFeatureVariableDouble = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, y.DOUBLE, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariableDouble")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getFeatureVariableInteger = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, y.INTEGER, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariableInteger")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getFeatureVariableString = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, y.STRING, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariableString")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getFeatureVariableJSON = function(e, t, r, n) {
                    try {
                        return this.isValidInstance() ? this.getFeatureVariableForType(e, t, y.JSON, r, n) : (this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getFeatureVariableJSON")), null)
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getAllFeatureVariables = function(e, t, r) {
                    var n = this;
                    try {
                        if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "getAllFeatureVariables")), null;
                        if (!this.validateInputs({
                                feature_key: e,
                                user_id: t
                            }, r)) return null;
                        var i = this.projectConfigManager.getConfig();
                        if (!i) return null;
                        var o = $(i, e, this.logger);
                        if (!o) return null;
                        var a = this.decisionService.getVariationForFeature(i, o, t, r).result,
                            u = Me(a),
                            l = {};
                        o.variables.forEach((function(r) {
                            l[r.key] = n.getFeatureVariableValueFromVariation(e, u, a.variation, r, t)
                        }));
                        var c = {};
                        return a.decisionSource === v.FEATURE_TEST && null !== a.experiment && null !== a.variation && (c = {
                            experimentKey: a.experiment.key,
                            variationKey: a.variation.key
                        }), this.notificationCenter.sendNotifications(E.DECISION, {
                            type: _.ALL_FEATURE_VARIABLES,
                            userId: t,
                            attributes: r || {},
                            decisionInfo: {
                                featureKey: e,
                                featureEnabled: u,
                                source: a.decisionSource,
                                variableValues: l,
                                sourceInfo: c
                            }
                        }), l
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.getOptimizelyConfig = function() {
                    try {
                        return this.projectConfigManager.getConfig() ? this.projectConfigManager.getOptimizelyConfig() : null
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), null
                    }
                }, e.prototype.close = function() {
                    var e = this;
                    try {
                        var t = this.eventProcessor.stop();
                        return this.disposeOnUpdate && (this.disposeOnUpdate(), this.disposeOnUpdate = null), this.projectConfigManager && this.projectConfigManager.stop(), Object.keys(this.readyTimeouts).forEach((function(t) {
                            var r = e.readyTimeouts[t];
                            clearTimeout(r.readyTimeout), r.onClose()
                        })), this.readyTimeouts = {}, t.then((function() {
                            return {
                                success: !0
                            }
                        }), (function(e) {
                            return {
                                success: !1,
                                reason: String(e)
                            }
                        }))
                    } catch (e) {
                        return this.logger.log(f.ERROR, e.message), this.errorHandler.handleError(e), Promise.resolve({
                            success: !1,
                            reason: String(e)
                        })
                    }
                }, e.prototype.onReady = function(e) {
                    var t, r, n = this;
                    "object" == typeof e && null !== e && void 0 !== e.timeout && (t = e.timeout), x.isSafeInteger(t) || (t = 3e4);
                    var i = new Promise((function(e) {
                            r = e
                        })),
                        o = this.nextReadyTimeoutId;
                    this.nextReadyTimeoutId++;
                    var a = setTimeout((function() {
                        delete n.readyTimeouts[o], r({
                            success: !1,
                            reason: s.sprintf("onReady timeout expired after %s ms", t)
                        })
                    }), t);
                    return this.readyTimeouts[o] = {
                        readyTimeout: a,
                        onClose: function() {
                            r({
                                success: !1,
                                reason: "Instance closed"
                            })
                        }
                    }, this.readyPromise.then((function() {
                        clearTimeout(a), delete n.readyTimeouts[o], r({
                            success: !0
                        })
                    })), Promise.race([this.readyPromise, i])
                }, e.prototype.createUserContext = function(e, t) {
                    return this.validateInputs({
                        user_id: e
                    }, t) ? new F({
                        optimizely: this,
                        userId: e,
                        attributes: t
                    }) : null
                }, e.prototype.decide = function(e, r, n) {
                    var i, o, a, u, l = this;
                    void 0 === n && (n = []);
                    var c = this.projectConfigManager.getConfig(),
                        h = [];
                    if (!this.isValidInstance() || !c) return h.push(T.SDK_NOT_READY), this.logger.log(f.INFO, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "decide")), P(r, e, h);
                    var g = c.featureKeyMap[r];
                    if (!g) return h.push(s.sprintf(T.FLAG_KEY_INVALID, r)), this.logger.log(f.ERROR, s.sprintf(p.FEATURE_NOT_IN_DATAFILE, "OPTIMIZELY", r)), P(r, e, h);
                    var I = e.getUserId(),
                        y = e.getAttributes(),
                        O = this.getAllDecideOptions(n),
                        R = this.decisionService.getVariationForFeature(c, g, I, y, O);
                    h.push.apply(h, R.reasons);
                    var A = R.result,
                        N = A.decisionSource,
                        m = null !== (o = null === (i = A.experiment) || void 0 === i ? void 0 : i.key) && void 0 !== o ? o : null,
                        L = null !== (u = null === (a = A.variation) || void 0 === a ? void 0 : a.key) && void 0 !== u ? u : null,
                        b = Me(A);
                    !0 === b ? this.logger.log(f.INFO, s.sprintf(d.FEATURE_ENABLED_FOR_USER, "OPTIMIZELY", r, I)) : this.logger.log(f.INFO, s.sprintf(d.FEATURE_NOT_ENABLED_FOR_USER, "OPTIMIZELY", r, I));
                    var U = {},
                        S = !1;
                    O[t.OptimizelyDecideOption.EXCLUDE_VARIABLES] || g.variables.forEach((function(e) {
                        U[e.key] = l.getFeatureVariableValueFromVariation(r, b, A.variation, e, I)
                    })), !O[t.OptimizelyDecideOption.DISABLE_DECISION_EVENT] && (N === v.FEATURE_TEST || N === v.ROLLOUT && ee(c)) && (this.sendImpressionEvent(A, r, I, b, y), S = !0);
                    var D = O[t.OptimizelyDecideOption.INCLUDE_REASONS] ? h : [],
                        C = {
                            flagKey: r,
                            enabled: b,
                            variationKey: L,
                            ruleKey: m,
                            variables: U,
                            reasons: D,
                            decisionEventDispatched: S
                        };
                    return this.notificationCenter.sendNotifications(E.DECISION, {
                        type: _.FLAG,
                        userId: I,
                        attributes: y,
                        decisionInfo: C
                    }), {
                        variationKey: L,
                        enabled: b,
                        variables: U,
                        ruleKey: m,
                        flagKey: r,
                        userContext: e,
                        reasons: D
                    }
                }, e.prototype.getAllDecideOptions = function(e) {
                    var r = this,
                        n = l({}, this.defaultDecideOptions);
                    return Array.isArray(e) ? e.forEach((function(e) {
                        t.OptimizelyDecideOption[e] ? n[e] = !0 : r.logger.log(f.WARNING, s.sprintf(d.UNRECOGNIZED_DECIDE_OPTION, "OPTIMIZELY", e))
                    })) : this.logger.log(f.DEBUG, s.sprintf(d.INVALID_DECIDE_OPTIONS, "OPTIMIZELY")), n
                }, e.prototype.decideForKeys = function(e, r, n) {
                    var i = this;
                    void 0 === n && (n = []);
                    var o = {};
                    if (!this.isValidInstance()) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "decideForKeys")), o;
                    if (0 === r.length) return o;
                    var a = this.getAllDecideOptions(n);
                    return r.forEach((function(r) {
                        var s = i.decide(e, r, n);
                        a[t.OptimizelyDecideOption.ENABLED_FLAGS_ONLY] && !s.enabled || (o[r] = s)
                    })), o
                }, e.prototype.decideAll = function(e, t) {
                    void 0 === t && (t = []);
                    var r = this.projectConfigManager.getConfig();
                    if (!this.isValidInstance() || !r) return this.logger.log(f.ERROR, s.sprintf(d.INVALID_OBJECT, "OPTIMIZELY", "decideAll")), {};
                    var n = Object.keys(r.featureKeyMap);
                    return this.decideForKeys(e, n, t)
                }, e
            }(),
            Ke = i.getLogger();
        i.setLogHandler(S()), i.setLogLevel(i.LogLevel.INFO);
        var Ye = !1,
            He = function(e) {
                try {
                    e.errorHandler && i.setErrorHandler(e.errorHandler), e.logger && (i.setLogHandler(e.logger), i.setLogLevel(i.LogLevel.NOTSET)), void 0 !== e.logLevel && i.setLogLevel(e.logLevel);
                    try {
                        m(e), e.isValidInstance = !0
                    } catch (i) {
                        Ke.error(i), e.isValidInstance = !1
                    }
                    var t = void 0;
                    null == e.eventDispatcher ? (t = new o.LocalStoragePendingEventsDispatcher({
                        eventDispatcher: b
                    }), Ye || (t.sendPendingEvents(), Ye = !0)) : t = e.eventDispatcher;
                    var r = e.eventBatchSize,
                        n = e.eventFlushInterval;
                    (function(e) {
                        return !("number" != typeof e || !x.isSafeInteger(e)) && e >= 1
                    })(e.eventBatchSize) || (Ke.warn("Invalid eventBatchSize %s, defaulting to %s", e.eventBatchSize, 10), r = 10),
                    function(e) {
                        return !("number" != typeof e || !x.isSafeInteger(e)) && e > 0
                    }(e.eventFlushInterval) || (Ke.warn("Invalid eventFlushInterval %s, defaulting to %s", e.eventFlushInterval, 1e3), n = 1e3);
                    var s = l(l({
                            clientEngine: "javascript-sdk",
                            eventDispatcher: t
                        }, e), {
                            eventBatchSize: r,
                            eventFlushInterval: n,
                            logger: Ke,
                            errorHandler: i.getErrorHandler()
                        }),
                        a = new je(s);
                    try {
                        if ("function" == typeof window.addEventListener) {
                            var u = "onpagehide" in window ? "pagehide" : "unload";
                            window.addEventListener(u, (function() {
                                a.close()
                            }), !1)
                        }
                    } catch (e) {
                        Ke.error(d.UNABLE_TO_ATTACH_UNLOAD, "INDEX_BROWSER", e.message)
                    }
                    return a
                } catch (e) {
                    return Ke.error(e), null
                }
            },
            ze = function() {
                Ye = !1
            },
            Je = {
                logging: V,
                errorHandler: L,
                eventDispatcher: b,
                enums: R,
                setLogger: i.setLogHandler,
                setLogLevel: i.setLogLevel,
                createInstance: He,
                __internalResetRetryState: ze,
                OptimizelyDecideOption: t.OptimizelyDecideOption
            };
        Object.defineProperty(t, "setLogLevel", {
            enumerable: !0,
            get: function() {
                return i.setLogLevel
            }
        }), Object.defineProperty(t, "setLogger", {
            enumerable: !0,
            get: function() {
                return i.setLogHandler
            }
        }), t.__internalResetRetryState = ze, t.createInstance = He, t.default = Je, t.enums = R, t.errorHandler = L, t.eventDispatcher = b, t.logging = V
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(7);

        function i(e) {
            return Object.keys(e).map((function(t) {
                return e[t]
            }))
        }
        t.generateUUID = function() {
                return n.v4()
            }, t.getTimestamp = function() {
                return (new Date).getTime()
            }, t.isValidEnum = function(e, t) {
                for (var r = !1, n = Object.keys(e), i = 0; i < n.length; i++)
                    if (t === e[n[i]]) {
                        r = !0;
                        break
                    }
                return r
            }, t.groupBy = function(e, t) {
                var r = {};
                return e.forEach((function(e) {
                    var n = t(e);
                    r[n] = r[n] || [], r[n].push(e)
                })), i(r)
            }, t.objectValues = i, t.objectEntries = function(e) {
                return Object.keys(e).map((function(t) {
                    return [t, e[t]]
                }))
            }, t.find = function(e, t) {
                for (var r, n = 0, i = e; n < i.length; n++) {
                    var o = i[n];
                    if (t(o)) {
                        r = o;
                        break
                    }
                }
                return r
            }, t.keyBy = function(e, t) {
                var r = {};
                return e.forEach((function(e) {
                    var n = t(e);
                    r[n] = e
                })), r
            }, t.sprintf = function(e) {
                for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                var n = 0;
                return e.replace(/%s/g, (function() {
                    var e = t[n++],
                        r = typeof e;
                    return "function" === r ? e() : "string" === r ? e : String(e)
                }))
            },
            function(e) {
                e.ACTIVATE = "ACTIVATE:experiment, user_id,attributes, variation, event", e.DECISION = "DECISION:type, userId, attributes, decisionInfo", e.LOG_EVENT = "LOG_EVENT:logEvent", e.OPTIMIZELY_CONFIG_UPDATE = "OPTIMIZELY_CONFIG_UPDATE", e.TRACK = "TRACK:event_key, user_id, attributes, event_tags, event"
            }(t.NOTIFICATION_TYPES || (t.NOTIFICATION_TYPES = {}))
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.DEFAULT_UPDATE_INTERVAL = 3e5, t.MIN_UPDATE_INTERVAL = 1e3, t.DEFAULT_URL_TEMPLATE = "https://cdn.optimizely.com/datafiles/%s.json", t.DEFAULT_AUTHENTICATED_URL_TEMPLATE = "https://config.optimizely.com/datafiles/auth/%s.json", t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT = [0, 8, 16, 32, 64, 128, 256, 512], t.REQUEST_TIMEOUT_MS = 6e4
    }, function(e, t, r) {
        e.exports = r(33)
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = function() {
            function e() {}
            return e.prototype.handleError = function(e) {}, e
        }();
        t.NoopErrorHandler = n;
        var i = new n;
        t.setErrorHandler = function(e) {
            i = e
        }, t.getErrorHandler = function() {
            return i
        }, t.resetErrorHandler = function() {
            i = new n
        }
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
                value: !0
            }),
            function(e) {
                e[e.NOTSET = 0] = "NOTSET", e[e.DEBUG = 1] = "DEBUG", e[e.INFO = 2] = "INFO", e[e.WARNING = 3] = "WARNING", e[e.ERROR = 4] = "ERROR"
            }(t.LogLevel || (t.LogLevel = {}))
    }, function(e, t, r) {
        var n = r(16),
            i = r(17),
            o = i;
        o.v1 = n, o.v4 = i, e.exports = o
    }, function(e, t) {
        var r = "undefined" != typeof crypto && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || "undefined" != typeof msCrypto && "function" == typeof window.msCrypto.getRandomValues && msCrypto.getRandomValues.bind(msCrypto);
        if (r) {
            var n = new Uint8Array(16);
            e.exports = function() {
                return r(n), n
            }
        } else {
            var i = new Array(16);
            e.exports = function() {
                for (var e, t = 0; t < 16; t++) 0 == (3 & t) && (e = 4294967296 * Math.random()), i[t] = e >>> ((3 & t) << 3) & 255;
                return i
            }
        }
    }, function(e, t) {
        for (var r = [], n = 0; n < 256; ++n) r[n] = (n + 256).toString(16).substr(1);
        e.exports = function(e, t) {
            var n = t || 0,
                i = r;
            return [i[e[n++]], i[e[n++]], i[e[n++]], i[e[n++]], "-", i[e[n++]], i[e[n++]], "-", i[e[n++]], i[e[n++]], "-", i[e[n++]], i[e[n++]], "-", i[e[n++]], i[e[n++]], i[e[n++]], i[e[n++]], i[e[n++]], i[e[n++]]].join("")
        }
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.areEventContextsEqual = void 0, t.areEventContextsEqual = function(e, t) {
            var r = e.context,
                n = t.context;
            return r.accountId === n.accountId && r.projectId === n.projectId && r.clientName === n.clientName && r.clientVersion === n.clientVersion && r.revision === n.revision && r.anonymizeIP === n.anonymizeIP && r.botFiltering === n.botFiltering
        }
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.sendEventNotification = t.getQueue = t.validateAndGetBatchSize = t.validateAndGetFlushInterval = t.DEFAULT_BATCH_SIZE = t.DEFAULT_FLUSH_INTERVAL = void 0;
        var n = r(19),
            i = r(0),
            o = r(2);
        t.DEFAULT_FLUSH_INTERVAL = 3e4, t.DEFAULT_BATCH_SIZE = 10;
        var s = i.getLogger("EventProcessor");
        t.validateAndGetFlushInterval = function(e) {
            return e <= 0 && (s.warn("Invalid flushInterval " + e + ", defaulting to " + t.DEFAULT_FLUSH_INTERVAL), e = t.DEFAULT_FLUSH_INTERVAL), e
        }, t.validateAndGetBatchSize = function(e) {
            return (e = Math.floor(e)) < 1 && (s.warn("Invalid batchSize " + e + ", defaulting to " + t.DEFAULT_BATCH_SIZE), e = t.DEFAULT_BATCH_SIZE), Math.max(1, e)
        }, t.getQueue = function(e, t, r, i) {
            return e > 1 ? new n.DefaultEventQueue({
                flushInterval: t,
                maxQueueSize: e,
                sink: r,
                batchComparator: i
            }) : new n.SingleEventQueue({
                sink: r
            })
        }, t.sendEventNotification = function(e, t) {
            e && e.sendNotifications(o.NOTIFICATION_TYPES.LOG_EVENT, t)
        }
    }, function(e, t, r) {
        "use strict";
        var n = this && this.__assign || function() {
            return (n = Object.assign || function(e) {
                for (var t, r = 1, n = arguments.length; r < n; r++)
                    for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                return e
            }).apply(this, arguments)
        };

        function i(e) {
            var t = [],
                r = e[0];
            return e.forEach((function(e) {
                if ("conversion" === e.type || "impression" === e.type) {
                    var r = a(e);
                    "impression" === e.type ? r.snapshots.push(s(e)) : "conversion" === e.type && r.snapshots.push(o(e)), t.push(r)
                }
            })), {
                client_name: r.context.clientName,
                client_version: r.context.clientVersion,
                account_id: r.context.accountId,
                project_id: r.context.projectId,
                revision: r.context.revision,
                anonymize_ip: r.context.anonymizeIP,
                enrich_decisions: !0,
                visitors: t
            }
        }

        function o(e) {
            var t = n({}, e.tags);
            delete t.revenue, delete t.value;
            var r = {
                entity_id: e.event.id,
                key: e.event.key,
                timestamp: e.timestamp,
                uuid: e.uuid
            };
            return e.tags && (r.tags = e.tags), null != e.value && (r.value = e.value), null != e.revenue && (r.revenue = e.revenue), {
                events: [r]
            }
        }

        function s(e) {
            var t = e.layer,
                r = e.experiment,
                n = e.variation,
                i = e.ruleKey,
                o = e.flagKey,
                s = e.ruleType,
                a = e.enabled,
                u = t ? t.id : null;
            return {
                decisions: [{
                    campaign_id: u,
                    experiment_id: r ? r.id : null,
                    variation_id: n ? n.id : null,
                    metadata: {
                        flag_key: o,
                        rule_key: i,
                        rule_type: s,
                        variation_key: n ? n.key : "",
                        enabled: a
                    }
                }],
                events: [{
                    entity_id: u,
                    timestamp: e.timestamp,
                    key: "campaign_activated",
                    uuid: e.uuid
                }]
            }
        }

        function a(e) {
            var t = {
                snapshots: [],
                visitor_id: e.user.id,
                attributes: []
            };
            return e.user.attributes.forEach((function(e) {
                t.attributes.push({
                    entity_id: e.entityId,
                    key: e.key,
                    type: "custom",
                    value: e.value
                })
            })), "boolean" == typeof e.context.botFiltering && t.attributes.push({
                entity_id: "$opt_bot_filtering",
                key: "$opt_bot_filtering",
                type: "custom",
                value: e.context.botFiltering
            }), t
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.formatEvents = t.buildConversionEventV1 = t.buildImpressionEventV1 = t.makeBatchedEventV1 = void 0, t.makeBatchedEventV1 = i, t.buildImpressionEventV1 = function(e) {
            var t = a(e);
            return t.snapshots.push(s(e)), {
                client_name: e.context.clientName,
                client_version: e.context.clientVersion,
                account_id: e.context.accountId,
                project_id: e.context.projectId,
                revision: e.context.revision,
                anonymize_ip: e.context.anonymizeIP,
                enrich_decisions: !0,
                visitors: [t]
            }
        }, t.buildConversionEventV1 = function(e) {
            var t = a(e);
            return t.snapshots.push(o(e)), {
                client_name: e.context.clientName,
                client_version: e.context.clientVersion,
                account_id: e.context.accountId,
                project_id: e.context.projectId,
                revision: e.context.revision,
                anonymize_ip: e.context.anonymizeIP,
                enrich_decisions: !0,
                visitors: [t]
            }
        }, t.formatEvents = function(e) {
            return {
                url: "https://logx.optimizely.com/v1/events",
                httpVerb: "POST",
                params: i(e)
            }
        }
    }, function(e, t, r) {
        e.exports = r(34)
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(5),
            i = r(15),
            o = r(6),
            s = {
                NOTSET: 0,
                DEBUG: 1,
                INFO: 2,
                WARNING: 3,
                ERROR: 4
            };

        function a(e) {
            return "string" != typeof e ? e : ("WARN" === (e = e.toUpperCase()) && (e = "WARNING"), s[e] ? s[e] : e)
        }
        var u = function() {
                function e() {
                    this.defaultLoggerFacade = new p, this.loggers = {}
                }
                return e.prototype.getLogger = function(e) {
                    return e ? (this.loggers[e] || (this.loggers[e] = new p({
                        messagePrefix: e
                    })), this.loggers[e]) : this.defaultLoggerFacade
                }, e
            }(),
            l = function() {
                function e(e) {
                    void 0 === e && (e = {}), this.logLevel = o.LogLevel.NOTSET, void 0 !== e.logLevel && i.isValidEnum(o.LogLevel, e.logLevel) && this.setLogLevel(e.logLevel), this.logToConsole = void 0 === e.logToConsole || !!e.logToConsole, this.prefix = void 0 !== e.prefix ? e.prefix : "[OPTIMIZELY]"
                }
                return e.prototype.log = function(e, t) {
                    if (this.shouldLog(e) && this.logToConsole) {
                        var r = this.prefix + " - " + this.getLogLevelName(e) + " " + this.getTime() + " " + t;
                        this.consoleLog(e, [r])
                    }
                }, e.prototype.setLogLevel = function(e) {
                    e = a(e), i.isValidEnum(o.LogLevel, e) && void 0 !== e ? this.logLevel = e : this.logLevel = o.LogLevel.ERROR
                }, e.prototype.getTime = function() {
                    return (new Date).toISOString()
                }, e.prototype.shouldLog = function(e) {
                    return e >= this.logLevel
                }, e.prototype.getLogLevelName = function(e) {
                    switch (e) {
                        case o.LogLevel.DEBUG:
                            return "DEBUG";
                        case o.LogLevel.INFO:
                            return "INFO ";
                        case o.LogLevel.WARNING:
                            return "WARN ";
                        case o.LogLevel.ERROR:
                            return "ERROR";
                        default:
                            return "NOTSET"
                    }
                }, e.prototype.consoleLog = function(e, t) {
                    switch (e) {
                        case o.LogLevel.DEBUG:
                            console.log.apply(console, t);
                            break;
                        case o.LogLevel.INFO:
                            console.info.apply(console, t);
                            break;
                        case o.LogLevel.WARNING:
                            console.warn.apply(console, t);
                            break;
                        case o.LogLevel.ERROR:
                            console.error.apply(console, t);
                            break;
                        default:
                            console.log.apply(console, t)
                    }
                }, e
            }();
        t.ConsoleLogHandler = l;
        var c = o.LogLevel.NOTSET,
            f = null,
            p = function() {
                function e(e) {
                    void 0 === e && (e = {}), this.messagePrefix = "", e.messagePrefix && (this.messagePrefix = e.messagePrefix)
                }
                return e.prototype.log = function(e, t) {
                    this.internalLog(a(e), {
                        message: t,
                        splat: []
                    })
                }, e.prototype.info = function(e) {
                    for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                    this.namedLog(o.LogLevel.INFO, e, t)
                }, e.prototype.debug = function(e) {
                    for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                    this.namedLog(o.LogLevel.DEBUG, e, t)
                }, e.prototype.warn = function(e) {
                    for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                    this.namedLog(o.LogLevel.WARNING, e, t)
                }, e.prototype.error = function(e) {
                    for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
                    this.namedLog(o.LogLevel.ERROR, e, t)
                }, e.prototype.format = function(e) {
                    return (this.messagePrefix ? this.messagePrefix + ": " : "") + i.sprintf.apply(void 0, [e.message].concat(e.splat))
                }, e.prototype.internalLog = function(e, t) {
                    f && (e < c || (f.log(e, this.format(t)), t.error && t.error instanceof Error && n.getErrorHandler().handleError(t.error)))
                }, e.prototype.namedLog = function(e, t, r) {
                    var n;
                    if (t instanceof Error) return t = (n = t).message, void this.internalLog(e, {
                        error: n,
                        message: t,
                        splat: r
                    });
                    if (0 !== r.length) {
                        var i = r[r.length - 1];
                        i instanceof Error && (n = i, r.splice(-1)), this.internalLog(e, {
                            message: t,
                            error: n,
                            splat: r
                        })
                    } else this.internalLog(e, {
                        message: t,
                        splat: r
                    })
                }, e
            }(),
            d = new u;
        t.getLogger = function(e) {
            return d.getLogger(e)
        }, t.setLogHandler = function(e) {
            f = e
        }, t.setLogLevel = function(e) {
            e = a(e), c = i.isValidEnum(o.LogLevel, e) && void 0 !== e ? e : o.LogLevel.ERROR
        }, t.getLogLevel = function() {
            return c
        }, t.resetLogger = function() {
            d = new u, c = o.LogLevel.NOTSET
        }
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(7);

        function i(e) {
            return Object.keys(e).map((function(t) {
                return e[t]
            }))
        }
        t.getTimestamp = function() {
            return (new Date).getTime()
        }, t.generateUUID = function() {
            return n.v4()
        }, t.isValidEnum = function(e, t) {
            for (var r = !1, n = Object.keys(e), i = 0; i < n.length; i++)
                if (t === e[n[i]]) {
                    r = !0;
                    break
                }
            return r
        }, t.groupBy = function(e, t) {
            var r = {};
            return e.forEach((function(e) {
                var n = t(e);
                r[n] = r[n] || [], r[n].push(e)
            })), i(r)
        }, t.objectValues = i, t.find = function(e, t) {
            for (var r, n = 0, i = e; n < i.length; n++) {
                var o = i[n];
                if (t(o)) {
                    r = o;
                    break
                }
            }
            return r
        }, t.keyBy = function(e, t) {
            var r = {};
            return e.forEach((function(e) {
                var n = t(e);
                r[n] = e
            })), r
        }, t.sprintf = function(e) {
            for (var t = [], r = 1; r < arguments.length; r++) t[r - 1] = arguments[r];
            var n = 0;
            return e.replace(/%s/g, (function() {
                var e = t[n++],
                    r = typeof e;
                return "function" === r ? e() : "string" === r ? e : String(e)
            }))
        }
    }, function(e, t, r) {
        var n, i, o = r(8),
            s = r(9),
            a = 0,
            u = 0;
        e.exports = function(e, t, r) {
            var l = t && r || 0,
                c = t || [],
                f = (e = e || {}).node || n,
                p = void 0 !== e.clockseq ? e.clockseq : i;
            if (null == f || null == p) {
                var d = o();
                null == f && (f = n = [1 | d[0], d[1], d[2], d[3], d[4], d[5]]), null == p && (p = i = 16383 & (d[6] << 8 | d[7]))
            }
            var h = void 0 !== e.msecs ? e.msecs : (new Date).getTime(),
                g = void 0 !== e.nsecs ? e.nsecs : u + 1,
                E = h - a + (g - u) / 1e4;
            if (E < 0 && void 0 === e.clockseq && (p = p + 1 & 16383), (E < 0 || h > a) && void 0 === e.nsecs && (g = 0), g >= 1e4) throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");
            a = h, u = g, i = p;
            var _ = (1e4 * (268435455 & (h += 122192928e5)) + g) % 4294967296;
            c[l++] = _ >>> 24 & 255, c[l++] = _ >>> 16 & 255, c[l++] = _ >>> 8 & 255, c[l++] = 255 & _;
            var v = h / 4294967296 * 1e4 & 268435455;
            c[l++] = v >>> 8 & 255, c[l++] = 255 & v, c[l++] = v >>> 24 & 15 | 16, c[l++] = v >>> 16 & 255, c[l++] = p >>> 8 | 128, c[l++] = 255 & p;
            for (var I = 0; I < 6; ++I) c[l + I] = f[I];
            return t || s(c)
        }
    }, function(e, t, r) {
        var n = r(8),
            i = r(9);
        e.exports = function(e, t, r) {
            var o = t && r || 0;
            "string" == typeof e && (t = "binary" === e ? new Array(16) : null, e = null);
            var s = (e = e || {}).random || (e.rng || n)();
            if (s[6] = 15 & s[6] | 64, s[8] = 63 & s[8] | 128, t)
                for (var a = 0; a < 16; ++a) t[o + a] = s[a];
            return t || i(s)
        }
    }, function(e, t, r) {
        "use strict";
        var n = this && this.__createBinding || (Object.create ? function(e, t, r, n) {
                void 0 === n && (n = r), Object.defineProperty(e, n, {
                    enumerable: !0,
                    get: function() {
                        return t[r]
                    }
                })
            } : function(e, t, r, n) {
                void 0 === n && (n = r), e[n] = t[r]
            }),
            i = this && this.__exportStar || function(e, t) {
                for (var r in e) "default" === r || Object.prototype.hasOwnProperty.call(t, r) || n(t, e, r)
            };
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), i(r(10), t), i(r(11), t), i(r(20), t), i(r(21), t), i(r(22), t), i(r(12), t), i(r(24), t)
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.DefaultEventQueue = t.SingleEventQueue = void 0;
        var n = r(0).getLogger("EventProcessor"),
            i = function() {
                function e(e) {
                    var t = e.timeout,
                        r = e.callback;
                    this.timeout = Math.max(t, 0), this.callback = r
                }
                return e.prototype.start = function() {
                    this.timeoutId = setTimeout(this.callback, this.timeout)
                }, e.prototype.refresh = function() {
                    this.stop(), this.start()
                }, e.prototype.stop = function() {
                    this.timeoutId && clearTimeout(this.timeoutId)
                }, e
            }(),
            o = function() {
                function e(e) {
                    var t = e.sink;
                    this.sink = t
                }
                return e.prototype.start = function() {}, e.prototype.stop = function() {
                    return Promise.resolve()
                }, e.prototype.enqueue = function(e) {
                    this.sink([e])
                }, e
            }();
        t.SingleEventQueue = o;
        var s = function() {
            function e(e) {
                var t = e.flushInterval,
                    r = e.maxQueueSize,
                    n = e.sink,
                    o = e.batchComparator;
                this.buffer = [], this.maxQueueSize = Math.max(r, 1), this.sink = n, this.batchComparator = o, this.timer = new i({
                    callback: this.flush.bind(this),
                    timeout: t
                }), this.started = !1
            }
            return e.prototype.start = function() {
                this.started = !0
            }, e.prototype.stop = function() {
                this.started = !1;
                var e = this.sink(this.buffer);
                return this.buffer = [], this.timer.stop(), e
            }, e.prototype.enqueue = function(e) {
                if (this.started) {
                    var t = this.buffer[0];
                    t && !this.batchComparator(t, e) && this.flush(), 0 === this.buffer.length && this.timer.refresh(), this.buffer.push(e), this.buffer.length >= this.maxQueueSize && this.flush()
                } else n.warn("Queue is stopped, not accepting event")
            }, e.prototype.flush = function() {
                this.sink(this.buffer), this.buffer = [], this.timer.stop()
            }, e
        }();
        t.DefaultEventQueue = s
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        })
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        })
    }, function(e, t, r) {
        "use strict";
        var n, i = this && this.__extends || (n = function(e, t) {
            return (n = Object.setPrototypeOf || {
                    __proto__: []
                }
                instanceof Array && function(e, t) {
                    e.__proto__ = t
                } || function(e, t) {
                    for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r])
                })(e, t)
        }, function(e, t) {
            function r() {
                this.constructor = e
            }
            n(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r)
        });
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.LocalStoragePendingEventsDispatcher = t.PendingEventsDispatcher = void 0;
        var o = r(0),
            s = r(23),
            a = r(2),
            u = o.getLogger("EventProcessor"),
            l = function() {
                function e(e) {
                    var t = e.eventDispatcher,
                        r = e.store;
                    this.dispatcher = t, this.store = r
                }
                return e.prototype.dispatchEvent = function(e, t) {
                    this.send({
                        uuid: a.generateUUID(),
                        timestamp: a.getTimestamp(),
                        request: e
                    }, t)
                }, e.prototype.sendPendingEvents = function() {
                    var e = this,
                        t = this.store.values();
                    u.debug("Sending %s pending events from previous page", t.length), t.forEach((function(t) {
                        try {
                            e.send(t, (function() {}))
                        } catch (r) {}
                    }))
                }, e.prototype.send = function(e, t) {
                    var r = this;
                    this.store.set(e.uuid, e), this.dispatcher.dispatchEvent(e.request, (function(n) {
                        r.store.remove(e.uuid), t(n)
                    }))
                }, e
            }();
        t.PendingEventsDispatcher = l;
        var c = function(e) {
            function t(t) {
                var r = t.eventDispatcher;
                return e.call(this, {
                    eventDispatcher: r,
                    store: new s.LocalStorageStore({
                        maxValues: 100,
                        key: "fs_optly_pending_events"
                    })
                }) || this
            }
            return i(t, e), t
        }(l);
        t.LocalStoragePendingEventsDispatcher = c
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.LocalStorageStore = void 0;
        var n = r(2),
            i = r(0).getLogger("EventProcessor"),
            o = function() {
                function e(e) {
                    var t = e.key,
                        r = e.maxValues,
                        n = void 0 === r ? 1e3 : r;
                    this.LS_KEY = t, this.maxValues = n
                }
                return e.prototype.get = function(e) {
                    return this.getMap()[e] || null
                }, e.prototype.set = function(e, t) {
                    var r = this.getMap();
                    r[e] = t, this.replace(r)
                }, e.prototype.remove = function(e) {
                    var t = this.getMap();
                    delete t[e], this.replace(t)
                }, e.prototype.values = function() {
                    return n.objectValues(this.getMap())
                }, e.prototype.clear = function() {
                    this.replace({})
                }, e.prototype.replace = function(e) {
                    try {
                        window.localStorage && localStorage.setItem(this.LS_KEY, JSON.stringify(e)), this.clean()
                    } catch (t) {
                        i.error(t)
                    }
                }, e.prototype.clean = function() {
                    var e = this.getMap(),
                        t = Object.keys(e),
                        r = t.length - this.maxValues;
                    if (!(r < 1)) {
                        var n = t.map((function(t) {
                            return {
                                key: t,
                                value: e[t]
                            }
                        }));
                        n.sort((function(e, t) {
                            return e.value.timestamp - t.value.timestamp
                        }));
                        for (var i = 0; i < r; i++) delete e[n[i].key];
                        this.replace(e)
                    }
                }, e.prototype.getMap = function() {
                    try {
                        var e = window.localStorage && localStorage.getItem(this.LS_KEY);
                        if (e) return JSON.parse(e) || {}
                    } catch (t) {
                        i.error(t)
                    }
                    return {}
                }, e
            }();
        t.LocalStorageStore = o
    }, function(e, t, r) {
        "use strict";
        var n = this && this.__awaiter || function(e, t, r, n) {
                return new(r || (r = Promise))((function(i, o) {
                    function s(e) {
                        try {
                            u(n.next(e))
                        } catch (t) {
                            o(t)
                        }
                    }

                    function a(e) {
                        try {
                            u(n.throw(e))
                        } catch (t) {
                            o(t)
                        }
                    }

                    function u(e) {
                        var t;
                        e.done ? i(e.value) : (t = e.value, t instanceof r ? t : new r((function(e) {
                            e(t)
                        }))).then(s, a)
                    }
                    u((n = n.apply(e, t || [])).next())
                }))
            },
            i = this && this.__generator || function(e, t) {
                var r, n, i, o, s = {
                    label: 0,
                    sent: function() {
                        if (1 & i[0]) throw i[1];
                        return i[1]
                    },
                    trys: [],
                    ops: []
                };
                return o = {
                    next: a(0),
                    throw: a(1),
                    return: a(2)
                }, "function" == typeof Symbol && (o[Symbol.iterator] = function() {
                    return this
                }), o;

                function a(o) {
                    return function(a) {
                        return function(o) {
                            if (r) throw new TypeError("Generator is already executing.");
                            for (; s;) try {
                                if (r = 1, n && (i = 2 & o[0] ? n.return : o[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, o[1])).done) return i;
                                switch (n = 0, i && (o = [2 & o[0], i.value]), o[0]) {
                                    case 0:
                                    case 1:
                                        i = o;
                                        break;
                                    case 4:
                                        return s.label++, {
                                            value: o[1],
                                            done: !1
                                        };
                                    case 5:
                                        s.label++, n = o[1], o = [0];
                                        continue;
                                    case 7:
                                        o = s.ops.pop(), s.trys.pop();
                                        continue;
                                    default:
                                        if (!((i = (i = s.trys).length > 0 && i[i.length - 1]) || 6 !== o[0] && 2 !== o[0])) {
                                            s = 0;
                                            continue
                                        }
                                        if (3 === o[0] && (!i || o[1] > i[0] && o[1] < i[3])) {
                                            s.label = o[1];
                                            break
                                        }
                                        if (6 === o[0] && s.label < i[1]) {
                                            s.label = i[1], i = o;
                                            break
                                        }
                                        if (i && s.label < i[2]) {
                                            s.label = i[2], s.ops.push(o);
                                            break
                                        }
                                        i[2] && s.ops.pop(), s.trys.pop();
                                        continue
                                }
                                o = t.call(e, s)
                            } catch (a) {
                                o = [6, a], n = 0
                            } finally {
                                r = i = 0
                            }
                            if (5 & o[0]) throw o[1];
                            return {
                                value: o[0] ? o[1] : void 0,
                                done: !0
                            }
                        }([o, a])
                    }
                }
            },
            o = this && this.__importDefault || function(e) {
                return e && e.__esModule ? e : {
                    default: e
                }
            };
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.LogTierV1EventProcessor = void 0;
        var s = r(0),
            a = r(11),
            u = o(r(25)),
            l = r(10),
            c = r(12),
            f = s.getLogger("LogTierV1EventProcessor"),
            p = function() {
                function e(e) {
                    var t = e.dispatcher,
                        r = e.flushInterval,
                        n = void 0 === r ? a.DEFAULT_FLUSH_INTERVAL : r,
                        i = e.batchSize,
                        o = void 0 === i ? a.DEFAULT_BATCH_SIZE : i,
                        s = e.notificationCenter;
                    this.dispatcher = t, this.notificationCenter = s, this.requestTracker = new u.default, n = a.validateAndGetFlushInterval(n), o = a.validateAndGetBatchSize(o), this.queue = a.getQueue(o, n, this.drainQueue.bind(this), l.areEventContextsEqual)
                }
                return e.prototype.drainQueue = function(e) {
                    var t = this,
                        r = new Promise((function(r) {
                            if (f.debug("draining queue with %s events", e.length), 0 !== e.length) {
                                var n = c.formatEvents(e);
                                t.dispatcher.dispatchEvent(n, (function() {
                                    r()
                                })), a.sendEventNotification(t.notificationCenter, n)
                            } else r()
                        }));
                    return this.requestTracker.trackRequest(r), r
                }, e.prototype.process = function(e) {
                    this.queue.enqueue(e)
                }, e.prototype.stop = function() {
                    try {
                        return this.queue.stop(), this.requestTracker.onRequestsComplete()
                    } catch (e) {
                        f.error('Error stopping EventProcessor: "%s"', e.message, e)
                    }
                    return Promise.resolve()
                }, e.prototype.start = function() {
                    return n(this, void 0, void 0, (function() {
                        return i(this, (function(e) {
                            return this.queue.start(), [2]
                        }))
                    }))
                }, e
            }();
        t.LogTierV1EventProcessor = p
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = function() {
            function e() {
                this.reqsInFlightCount = 0, this.reqsCompleteResolvers = []
            }
            return e.prototype.trackRequest = function(e) {
                var t = this;
                this.reqsInFlightCount++;
                var r = function() {
                    t.reqsInFlightCount--, 0 === t.reqsInFlightCount && (t.reqsCompleteResolvers.forEach((function(e) {
                        return e()
                    })), t.reqsCompleteResolvers = [])
                };
                e.then(r, r)
            }, e.prototype.onRequestsComplete = function() {
                var e = this;
                return new Promise((function(t) {
                    0 === e.reqsInFlightCount ? t() : e.reqsCompleteResolvers.push(t)
                }))
            }, e
        }();
        t.default = n
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(27);
        t.HttpPollingDatafileManager = n.default
    }, function(e, t, r) {
        "use strict";
        var n, i = this && this.__extends || (n = function(e, t) {
                return (n = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r])
                    })(e, t)
            }, function(e, t) {
                function r() {
                    this.constructor = e
                }
                n(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r)
            }),
            o = this && this.__importDefault || function(e) {
                return e && e.__esModule ? e : {
                    default: e
                }
            };
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var s = r(28),
            a = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return i(t, e), t.prototype.makeGetRequest = function(e, t) {
                    return s.makeGetRequest(e, t)
                }, t.prototype.getConfigDefaults = function() {
                    return {
                        autoUpdate: !1
                    }
                }, t
            }(o(r(29)).default);
        t.default = a
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(3),
            i = r(0).getLogger("DatafileManager");
        t.makeGetRequest = function(e, t) {
            var r = new XMLHttpRequest;
            return {
                responsePromise: new Promise((function(o, s) {
                    r.open("GET", e, !0),
                        function(e, t) {
                            Object.keys(e).forEach((function(r) {
                                var n = e[r];
                                t.setRequestHeader(r, n)
                            }))
                        }(t, r), r.onreadystatechange = function() {
                            if (4 === r.readyState) {
                                if (0 === r.status) return void s(new Error("Request error"));
                                var e = function(e) {
                                        var t = e.getAllResponseHeaders();
                                        if (null === t) return {};
                                        var r = t.split("\r\n"),
                                            n = {};
                                        return r.forEach((function(e) {
                                            var t = e.indexOf(": ");
                                            if (t > -1) {
                                                var r = e.slice(0, t),
                                                    i = e.slice(t + 2);
                                                i.length > 0 && (n[r] = i)
                                            }
                                        })), n
                                    }(r),
                                    t = {
                                        statusCode: r.status,
                                        body: r.responseText,
                                        headers: e
                                    };
                                o(t)
                            }
                        }, r.timeout = n.REQUEST_TIMEOUT_MS, r.ontimeout = function() {
                            i.error("Request timed out")
                        }, r.send()
                })),
                abort: function() {
                    r.abort()
                }
            }
        }
    }, function(e, t, r) {
        "use strict";
        var n = this && this.__assign || function() {
                return (n = Object.assign || function(e) {
                    for (var t, r = 1, n = arguments.length; r < n; r++)
                        for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                    return e
                }).apply(this, arguments)
            },
            i = this && this.__importDefault || function(e) {
                return e && e.__esModule ? e : {
                    default: e
                }
            };
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var o = r(0),
            s = r(2),
            a = i(r(30)),
            u = r(3),
            l = i(r(31)),
            c = o.getLogger("DatafileManager");

        function f(e) {
            return e >= 200 && e < 400
        }
        var p = {
                get: function() {
                    return Promise.resolve("")
                },
                set: function() {
                    return Promise.resolve()
                },
                contains: function() {
                    return Promise.resolve(!1)
                },
                remove: function() {
                    return Promise.resolve()
                }
            },
            d = function() {
                function e(e) {
                    var t = this,
                        r = n({}, this.getConfigDefaults(), e),
                        i = r.datafile,
                        o = r.autoUpdate,
                        f = void 0 !== o && o,
                        d = r.sdkKey,
                        h = r.updateInterval,
                        g = void 0 === h ? u.DEFAULT_UPDATE_INTERVAL : h,
                        E = r.urlTemplate,
                        _ = void 0 === E ? u.DEFAULT_URL_TEMPLATE : E,
                        v = r.cache,
                        I = void 0 === v ? p : v;
                    this.cache = I, this.cacheKey = "opt-datafile-" + d, this.isReadyPromiseSettled = !1, this.readyPromiseResolver = function() {}, this.readyPromiseRejecter = function() {}, this.readyPromise = new Promise((function(e, r) {
                            t.readyPromiseResolver = e, t.readyPromiseRejecter = r
                        })), i ? (this.currentDatafile = i, d || this.resolveReadyPromise()) : this.currentDatafile = "", this.isStarted = !1, this.datafileUrl = s.sprintf(_, d), this.emitter = new a.default, this.autoUpdate = f,
                        function(e) {
                            return e >= u.MIN_UPDATE_INTERVAL
                        }(g) ? this.updateInterval = g : (c.warn("Invalid updateInterval %s, defaulting to %s", g, u.DEFAULT_UPDATE_INTERVAL), this.updateInterval = u.DEFAULT_UPDATE_INTERVAL), this.currentTimeout = null, this.currentRequest = null, this.backoffController = new l.default, this.syncOnCurrentRequestComplete = !1
                }
                return e.prototype.get = function() {
                    return this.currentDatafile
                }, e.prototype.start = function() {
                    this.isStarted || (c.debug("Datafile manager started"), this.isStarted = !0, this.backoffController.reset(), this.setDatafileFromCacheIfAvailable(), this.syncDatafile())
                }, e.prototype.stop = function() {
                    return c.debug("Datafile manager stopped"), this.isStarted = !1, this.currentTimeout && (clearTimeout(this.currentTimeout), this.currentTimeout = null), this.emitter.removeAllListeners(), this.currentRequest && (this.currentRequest.abort(), this.currentRequest = null), Promise.resolve()
                }, e.prototype.onReady = function() {
                    return this.readyPromise
                }, e.prototype.on = function(e, t) {
                    return this.emitter.on(e, t)
                }, e.prototype.onRequestRejected = function(e) {
                    this.isStarted && (this.backoffController.countError(), e instanceof Error ? c.error("Error fetching datafile: %s", e.message, e) : "string" == typeof e ? c.error("Error fetching datafile: %s", e) : c.error("Error fetching datafile"))
                }, e.prototype.onRequestResolved = function(e) {
                    if (this.isStarted) {
                        void 0 !== e.statusCode && f(e.statusCode) ? this.backoffController.reset() : this.backoffController.countError(), this.trySavingLastModified(e.headers);
                        var t = this.getNextDatafileFromResponse(e);
                        if ("" !== t)
                            if (c.info("Updating datafile from response"), this.currentDatafile = t, this.cache.set(this.cacheKey, t), this.isReadyPromiseSettled) {
                                var r = {
                                    datafile: t
                                };
                                this.emitter.emit("update", r)
                            } else this.resolveReadyPromise()
                    }
                }, e.prototype.onRequestComplete = function() {
                    this.isStarted && (this.currentRequest = null, this.isReadyPromiseSettled || this.autoUpdate || this.rejectReadyPromise(new Error("Failed to become ready")), this.autoUpdate && this.syncOnCurrentRequestComplete && this.syncDatafile(), this.syncOnCurrentRequestComplete = !1)
                }, e.prototype.syncDatafile = function() {
                    var e = this,
                        t = {};
                    this.lastResponseLastModified && (t["if-modified-since"] = this.lastResponseLastModified), c.debug("Making datafile request to url %s with headers: %s", this.datafileUrl, (function() {
                        return JSON.stringify(t)
                    })), this.currentRequest = this.makeGetRequest(this.datafileUrl, t);
                    var r = function() {
                        e.onRequestComplete()
                    };
                    this.currentRequest.responsePromise.then((function(t) {
                        e.onRequestResolved(t)
                    }), (function(t) {
                        e.onRequestRejected(t)
                    })).then(r, r), this.autoUpdate && this.scheduleNextUpdate()
                }, e.prototype.resolveReadyPromise = function() {
                    this.readyPromiseResolver(), this.isReadyPromiseSettled = !0
                }, e.prototype.rejectReadyPromise = function(e) {
                    this.readyPromiseRejecter(e), this.isReadyPromiseSettled = !0
                }, e.prototype.scheduleNextUpdate = function() {
                    var e = this,
                        t = this.backoffController.getDelay(),
                        r = Math.max(t, this.updateInterval);
                    c.debug("Scheduling sync in %s ms", r), this.currentTimeout = setTimeout((function() {
                        e.currentRequest ? e.syncOnCurrentRequestComplete = !0 : e.syncDatafile()
                    }), r)
                }, e.prototype.getNextDatafileFromResponse = function(e) {
                    return c.debug("Response status code: %s", e.statusCode), void 0 === e.statusCode || 304 === e.statusCode ? "" : f(e.statusCode) ? e.body : ""
                }, e.prototype.trySavingLastModified = function(e) {
                    var t = e["last-modified"] || e["Last-Modified"];
                    void 0 !== t && (this.lastResponseLastModified = t, c.debug("Saved last modified header value from response: %s", this.lastResponseLastModified))
                }, e.prototype.setDatafileFromCacheIfAvailable = function() {
                    var e = this;
                    this.cache.get(this.cacheKey).then((function(t) {
                        e.isStarted && !e.isReadyPromiseSettled && "" !== t && (c.debug("Using datafile from cache"), e.currentDatafile = t, e.resolveReadyPromise())
                    }))
                }, e
            }();
        t.default = d
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = function() {
            function e() {
                this.listeners = {}, this.listenerId = 1
            }
            return e.prototype.on = function(e, t) {
                var r = this;
                this.listeners[e] || (this.listeners[e] = {});
                var n = String(this.listenerId);
                return this.listenerId++, this.listeners[e][n] = t,
                    function() {
                        r.listeners[e] && delete r.listeners[e][n]
                    }
            }, e.prototype.emit = function(e, t) {
                var r = this.listeners[e];
                r && Object.keys(r).forEach((function(e) {
                    (0, r[e])(t)
                }))
            }, e.prototype.removeAllListeners = function() {
                this.listeners = {}
            }, e
        }();
        t.default = n
    }, function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var n = r(3),
            i = function() {
                function e() {
                    this.errorCount = 0
                }
                return e.prototype.getDelay = function() {
                    return 0 === this.errorCount ? 0 : 1e3 * n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length - 1, this.errorCount)] + Math.round(1e3 * Math.random())
                }, e.prototype.countError = function() {
                    this.errorCount < n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length - 1 && this.errorCount++
                }, e.prototype.reset = function() {
                    this.errorCount = 0
                }, e
            }();
        t.default = i
    }, function(e, t, r) {
        ! function() {
            function t(e, t) {
                var r, n, i, o, s, a, u, l;
                for (r = 3 & e.length, n = e.length - r, i = t, s = 3432918353, a = 461845907, l = 0; l < n;) u = 255 & e.charCodeAt(l) | (255 & e.charCodeAt(++l)) << 8 | (255 & e.charCodeAt(++l)) << 16 | (255 & e.charCodeAt(++l)) << 24, ++l, i = 27492 + (65535 & (o = 5 * (65535 & (i = (i ^= u = (65535 & (u = (u = (65535 & u) * s + (((u >>> 16) * s & 65535) << 16) & 4294967295) << 15 | u >>> 17)) * a + (((u >>> 16) * a & 65535) << 16) & 4294967295) << 13 | i >>> 19)) + ((5 * (i >>> 16) & 65535) << 16) & 4294967295)) + ((58964 + (o >>> 16) & 65535) << 16);
                switch (u = 0, r) {
                    case 3:
                        u ^= (255 & e.charCodeAt(l + 2)) << 16;
                    case 2:
                        u ^= (255 & e.charCodeAt(l + 1)) << 8;
                    case 1:
                        i ^= u = (65535 & (u = (u = (65535 & (u ^= 255 & e.charCodeAt(l))) * s + (((u >>> 16) * s & 65535) << 16) & 4294967295) << 15 | u >>> 17)) * a + (((u >>> 16) * a & 65535) << 16) & 4294967295
                }
                return i ^= e.length, i = 2246822507 * (65535 & (i ^= i >>> 16)) + ((2246822507 * (i >>> 16) & 65535) << 16) & 4294967295, i = 3266489909 * (65535 & (i ^= i >>> 13)) + ((3266489909 * (i >>> 16) & 65535) << 16) & 4294967295, (i ^= i >>> 16) >>> 0
            }
            var r = t;
            r.v2 = function(e, t) {
                for (var r, n = e.length, i = t ^ n, o = 0; n >= 4;) r = 1540483477 * (65535 & (r = 255 & e.charCodeAt(o) | (255 & e.charCodeAt(++o)) << 8 | (255 & e.charCodeAt(++o)) << 16 | (255 & e.charCodeAt(++o)) << 24)) + ((1540483477 * (r >>> 16) & 65535) << 16), i = 1540483477 * (65535 & i) + ((1540483477 * (i >>> 16) & 65535) << 16) ^ (r = 1540483477 * (65535 & (r ^= r >>> 24)) + ((1540483477 * (r >>> 16) & 65535) << 16)), n -= 4, ++o;
                switch (n) {
                    case 3:
                        i ^= (255 & e.charCodeAt(o + 2)) << 16;
                    case 2:
                        i ^= (255 & e.charCodeAt(o + 1)) << 8;
                    case 1:
                        i = 1540483477 * (65535 & (i ^= 255 & e.charCodeAt(o))) + ((1540483477 * (i >>> 16) & 65535) << 16)
                }
                return i = 1540483477 * (65535 & (i ^= i >>> 13)) + ((1540483477 * (i >>> 16) & 65535) << 16), (i ^= i >>> 15) >>> 0
            }, r.v3 = t, e.exports = r
        }()
    }, function(e, t, r) {
        ! function(r, n) {
            "use strict";
            var i = {
                version: "3.0.1",
                x86: {},
                x64: {}
            };

            function o(e, t) {
                return (65535 & e) * t + (((e >>> 16) * t & 65535) << 16)
            }

            function s(e, t) {
                return e << t | e >>> 32 - t
            }

            function a(e) {
                return e = o(e ^= e >>> 16, 2246822507), (e = o(e ^= e >>> 13, 3266489909)) ^ e >>> 16
            }

            function u(e, t) {
                e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]], t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]];
                var r = [0, 0, 0, 0];
                return r[3] += e[3] + t[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += e[2] + t[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += e[1] + t[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += e[0] + t[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]]
            }

            function l(e, t) {
                e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]], t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]];
                var r = [0, 0, 0, 0];
                return r[3] += e[3] * t[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += e[2] * t[3], r[1] += r[2] >>> 16, r[2] &= 65535, r[2] += e[3] * t[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += e[1] * t[3], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += e[2] * t[2], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += e[3] * t[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += e[0] * t[3] + e[1] * t[2] + e[2] * t[1] + e[3] * t[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]]
            }

            function c(e, t) {
                return 32 == (t %= 64) ? [e[1], e[0]] : t < 32 ? [e[0] << t | e[1] >>> 32 - t, e[1] << t | e[0] >>> 32 - t] : (t -= 32, [e[1] << t | e[0] >>> 32 - t, e[0] << t | e[1] >>> 32 - t])
            }

            function f(e, t) {
                return 0 == (t %= 64) ? e : t < 32 ? [e[0] << t | e[1] >>> 32 - t, e[1] << t] : [e[1] << t - 32, 0]
            }

            function p(e, t) {
                return [e[0] ^ t[0], e[1] ^ t[1]]
            }

            function d(e) {
                return e = p(e, [0, e[0] >>> 1]), e = p(e = l(e, [4283543511, 3981806797]), [0, e[0] >>> 1]), p(e = l(e, [3301882366, 444984403]), [0, e[0] >>> 1])
            }
            i.x86.hash32 = function(e, t) {
                t = t || 0;
                for (var r = (e = e || "").length % 4, n = e.length - r, i = t, u = 0, l = 3432918353, c = 461845907, f = 0; f < n; f += 4) u = o(u = 255 & e.charCodeAt(f) | (255 & e.charCodeAt(f + 1)) << 8 | (255 & e.charCodeAt(f + 2)) << 16 | (255 & e.charCodeAt(f + 3)) << 24, l), u = o(u = s(u, 15), c), i = o(i = s(i ^= u, 13), 5) + 3864292196;
                switch (u = 0, r) {
                    case 3:
                        u ^= (255 & e.charCodeAt(f + 2)) << 16;
                    case 2:
                        u ^= (255 & e.charCodeAt(f + 1)) << 8;
                    case 1:
                        u = o(u ^= 255 & e.charCodeAt(f), l), i ^= u = o(u = s(u, 15), c)
                }
                return (i = a(i ^= e.length)) >>> 0
            }, i.x86.hash128 = function(e, t) {
                t = t || 0;
                for (var r = (e = e || "").length % 16, n = e.length - r, i = t, u = t, l = t, c = t, f = 0, p = 0, d = 0, h = 0, g = 597399067, E = 2869860233, _ = 951274213, v = 2716044179, I = 0; I < n; I += 16) f = 255 & e.charCodeAt(I) | (255 & e.charCodeAt(I + 1)) << 8 | (255 & e.charCodeAt(I + 2)) << 16 | (255 & e.charCodeAt(I + 3)) << 24, p = 255 & e.charCodeAt(I + 4) | (255 & e.charCodeAt(I + 5)) << 8 | (255 & e.charCodeAt(I + 6)) << 16 | (255 & e.charCodeAt(I + 7)) << 24, d = 255 & e.charCodeAt(I + 8) | (255 & e.charCodeAt(I + 9)) << 8 | (255 & e.charCodeAt(I + 10)) << 16 | (255 & e.charCodeAt(I + 11)) << 24, h = 255 & e.charCodeAt(I + 12) | (255 & e.charCodeAt(I + 13)) << 8 | (255 & e.charCodeAt(I + 14)) << 16 | (255 & e.charCodeAt(I + 15)) << 24, f = s(f = o(f, g), 15), i = s(i ^= f = o(f, E), 19), i = o(i += u, 5) + 1444728091, p = s(p = o(p, E), 16), u = s(u ^= p = o(p, _), 17), u = o(u += l, 5) + 197830471, d = s(d = o(d, _), 17), l = s(l ^= d = o(d, v), 15), l = o(l += c, 5) + 2530024501, h = s(h = o(h, v), 18), c = s(c ^= h = o(h, g), 13), c = o(c += i, 5) + 850148119;
                switch (f = 0, p = 0, d = 0, h = 0, r) {
                    case 15:
                        h ^= e.charCodeAt(I + 14) << 16;
                    case 14:
                        h ^= e.charCodeAt(I + 13) << 8;
                    case 13:
                        h = o(h ^= e.charCodeAt(I + 12), v), c ^= h = o(h = s(h, 18), g);
                    case 12:
                        d ^= e.charCodeAt(I + 11) << 24;
                    case 11:
                        d ^= e.charCodeAt(I + 10) << 16;
                    case 10:
                        d ^= e.charCodeAt(I + 9) << 8;
                    case 9:
                        d = o(d ^= e.charCodeAt(I + 8), _), l ^= d = o(d = s(d, 17), v);
                    case 8:
                        p ^= e.charCodeAt(I + 7) << 24;
                    case 7:
                        p ^= e.charCodeAt(I + 6) << 16;
                    case 6:
                        p ^= e.charCodeAt(I + 5) << 8;
                    case 5:
                        p = o(p ^= e.charCodeAt(I + 4), E), u ^= p = o(p = s(p, 16), _);
                    case 4:
                        f ^= e.charCodeAt(I + 3) << 24;
                    case 3:
                        f ^= e.charCodeAt(I + 2) << 16;
                    case 2:
                        f ^= e.charCodeAt(I + 1) << 8;
                    case 1:
                        f = o(f ^= e.charCodeAt(I), g), i ^= f = o(f = s(f, 15), E)
                }
                return i ^= e.length, i += u ^= e.length, i += l ^= e.length, u += i += c ^= e.length, l += i, c += i, i = a(i), i += u = a(u), i += l = a(l), u += i += c = a(c), l += i, c += i, ("00000000" + (i >>> 0).toString(16)).slice(-8) + ("00000000" + (u >>> 0).toString(16)).slice(-8) + ("00000000" + (l >>> 0).toString(16)).slice(-8) + ("00000000" + (c >>> 0).toString(16)).slice(-8)
            }, i.x64.hash128 = function(e, t) {
                t = t || 0;
                for (var r = (e = e || "").length % 16, n = e.length - r, i = [0, t], o = [0, t], s = [0, 0], a = [0, 0], h = [2277735313, 289559509], g = [1291169091, 658871167], E = 0; E < n; E += 16) s = [255 & e.charCodeAt(E + 4) | (255 & e.charCodeAt(E + 5)) << 8 | (255 & e.charCodeAt(E + 6)) << 16 | (255 & e.charCodeAt(E + 7)) << 24, 255 & e.charCodeAt(E) | (255 & e.charCodeAt(E + 1)) << 8 | (255 & e.charCodeAt(E + 2)) << 16 | (255 & e.charCodeAt(E + 3)) << 24], a = [255 & e.charCodeAt(E + 12) | (255 & e.charCodeAt(E + 13)) << 8 | (255 & e.charCodeAt(E + 14)) << 16 | (255 & e.charCodeAt(E + 15)) << 24, 255 & e.charCodeAt(E + 8) | (255 & e.charCodeAt(E + 9)) << 8 | (255 & e.charCodeAt(E + 10)) << 16 | (255 & e.charCodeAt(E + 11)) << 24], s = c(s = l(s, h), 31), i = u(i = c(i = p(i, s = l(s, g)), 27), o), i = u(l(i, [0, 5]), [0, 1390208809]), a = c(a = l(a, g), 33), o = u(o = c(o = p(o, a = l(a, h)), 31), i), o = u(l(o, [0, 5]), [0, 944331445]);
                switch (s = [0, 0], a = [0, 0], r) {
                    case 15:
                        a = p(a, f([0, e.charCodeAt(E + 14)], 48));
                    case 14:
                        a = p(a, f([0, e.charCodeAt(E + 13)], 40));
                    case 13:
                        a = p(a, f([0, e.charCodeAt(E + 12)], 32));
                    case 12:
                        a = p(a, f([0, e.charCodeAt(E + 11)], 24));
                    case 11:
                        a = p(a, f([0, e.charCodeAt(E + 10)], 16));
                    case 10:
                        a = p(a, f([0, e.charCodeAt(E + 9)], 8));
                    case 9:
                        a = l(a = p(a, [0, e.charCodeAt(E + 8)]), g), o = p(o, a = l(a = c(a, 33), h));
                    case 8:
                        s = p(s, f([0, e.charCodeAt(E + 7)], 56));
                    case 7:
                        s = p(s, f([0, e.charCodeAt(E + 6)], 48));
                    case 6:
                        s = p(s, f([0, e.charCodeAt(E + 5)], 40));
                    case 5:
                        s = p(s, f([0, e.charCodeAt(E + 4)], 32));
                    case 4:
                        s = p(s, f([0, e.charCodeAt(E + 3)], 24));
                    case 3:
                        s = p(s, f([0, e.charCodeAt(E + 2)], 16));
                    case 2:
                        s = p(s, f([0, e.charCodeAt(E + 1)], 8));
                    case 1:
                        s = l(s = p(s, [0, e.charCodeAt(E)]), h), i = p(i, s = l(s = c(s, 31), g))
                }
                return i = u(i = p(i, [0, e.length]), o = p(o, [0, e.length])), o = u(o, i), i = u(i = d(i), o = d(o)), o = u(o, i), ("00000000" + (i[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (i[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (o[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (o[1] >>> 0).toString(16)).slice(-8)
            }, e.exports && (t = e.exports = i), t.murmurHash3 = i
        }()
    }, function(e, t, r) {
        "use strict";
        r.r(t), r.d(t, "EExperimentProvider", (function() {
            return H
        })), r.d(t, "ExperimentFactory", (function() {
            return q
        })), r.d(t, "LogLevel", (function() {
            return u
        }));
        /*! *****************************************************************************
        Copyright (c) Microsoft Corporation.

        Permission to use, copy, modify, and/or distribute this software for any
        purpose with or without fee is hereby granted.

        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
        PERFORMANCE OF THIS SOFTWARE.
        ***************************************************************************** */
        var n = function(e, t) {
            return (n = Object.setPrototypeOf || {
                    __proto__: []
                }
                instanceof Array && function(e, t) {
                    e.__proto__ = t
                } || function(e, t) {
                    for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r])
                })(e, t)
        };

        function i(e, t) {
            function r() {
                this.constructor = e
            }
            n(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r)
        }
        var o = function() {
            return (o = Object.assign || function(e) {
                for (var t, r = 1, n = arguments.length; r < n; r++)
                    for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                return e
            }).apply(this, arguments)
        };

        function s(e, t, r, n) {
            return new(r || (r = Promise))((function(i, o) {
                function s(e) {
                    try {
                        u(n.next(e))
                    } catch (t) {
                        o(t)
                    }
                }

                function a(e) {
                    try {
                        u(n.throw(e))
                    } catch (t) {
                        o(t)
                    }
                }

                function u(e) {
                    var t;
                    e.done ? i(e.value) : (t = e.value, t instanceof r ? t : new r((function(e) {
                        e(t)
                    }))).then(s, a)
                }
                u((n = n.apply(e, t || [])).next())
            }))
        }

        function a(e, t) {
            var r, n, i, o, s = {
                label: 0,
                sent: function() {
                    if (1 & i[0]) throw i[1];
                    return i[1]
                },
                trys: [],
                ops: []
            };
            return o = {
                next: a(0),
                throw: a(1),
                return: a(2)
            }, "function" == typeof Symbol && (o[Symbol.iterator] = function() {
                return this
            }), o;

            function a(o) {
                return function(a) {
                    return function(o) {
                        if (r) throw new TypeError("Generator is already executing.");
                        for (; s;) try {
                            if (r = 1, n && (i = 2 & o[0] ? n.return : o[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, o[1])).done) return i;
                            switch (n = 0, i && (o = [2 & o[0], i.value]), o[0]) {
                                case 0:
                                case 1:
                                    i = o;
                                    break;
                                case 4:
                                    return s.label++, {
                                        value: o[1],
                                        done: !1
                                    };
                                case 5:
                                    s.label++, n = o[1], o = [0];
                                    continue;
                                case 7:
                                    o = s.ops.pop(), s.trys.pop();
                                    continue;
                                default:
                                    if (!((i = (i = s.trys).length > 0 && i[i.length - 1]) || 6 !== o[0] && 2 !== o[0])) {
                                        s = 0;
                                        continue
                                    }
                                    if (3 === o[0] && (!i || o[1] > i[0] && o[1] < i[3])) {
                                        s.label = o[1];
                                        break
                                    }
                                    if (6 === o[0] && s.label < i[1]) {
                                        s.label = i[1], i = o;
                                        break
                                    }
                                    if (i && s.label < i[2]) {
                                        s.label = i[2], s.ops.push(o);
                                        break
                                    }
                                    i[2] && s.ops.pop(), s.trys.pop();
                                    continue
                            }
                            o = t.call(e, s)
                        } catch (a) {
                            o = [6, a], n = 0
                        } finally {
                            r = i = 0
                        }
                        if (5 & o[0]) throw o[1];
                        return {
                            value: o[0] ? o[1] : void 0,
                            done: !0
                        }
                    }([o, a])
                }
            }
        }
        var u, l = r(1),
            c = r(4),
            f = function() {
                function e(e, t) {
                    this._userId = e, (null == t ? void 0 : t.logCallback) && this.setLogCallback(t.logCallback)
                }
                return e.prototype.setLogCallback = function(e) {
                    this._logCallback = e
                }, e.prototype.log = function(e, t) {
                    var r;
                    null === (r = this._logCallback) || void 0 === r || r.call(this, e, t)
                }, e.prototype.timeout = function(e, t) {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(r) {
                            return [2, new Promise((function(r, n) {
                                setTimeout((function() {
                                    n(new Error(t))
                                }), e)
                            }))]
                        }))
                    }))
                }, e.prototype.getSplitTestLane = function(e, t) {
                    void 0 === t && (t = "");
                    var r = c.x86.hash32(t);
                    return c.x86.hash32(this._userId, r) % e
                }, e
            }();
        ! function(e) {
            e[e.info = 0] = "info", e[e.warning = 1] = "warning", e[e.error = 2] = "error"
        }(u || (u = {}));
        var p, d = function() {
            function e(e, t) {
                this._endpoints = e, this._log = t
            }
            return e.prototype.dispatchEvent = function(e, t) {
                var r = this;
                if ("POST" === e.httpVerb) {
                    var n = {
                        url: e.url,
                        event: e.params
                    };
                    fetch(this._endpoints.trackingUrl, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(n)
                    }).then((function(e) {
                        e.ok ? null == t || t({
                            statusCode: e.status
                        }) : r._log("Event dispatch failed: " + e.status + " - " + e.statusText, u.error)
                    })).catch((function(e) {
                        r._log("Event dispatch failed: " + e, u.error)
                    }))
                } else this._log("Only POST is supported for track call", u.error)
            }, e
        }();
        ! function(e) {
            e[e.Local = 0] = "Local", e[e.QABox = 1] = "QABox", e[e.Dev = 2] = "Dev", e[e.Staging = 3] = "Staging", e[e.Production = 4] = "Production"
        }(p || (p = {}));
        var h, g = function() {
                function e() {}
                return e.getParameterValue = function(e) {
                    var t = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(window.location.search);
                    return t ? decodeURIComponent(t[1].replace(/\+/g, " ")) : void 0
                }, e
            }(),
            E = function() {
                function e() {}
                return e.prototype.getCurrentEnvironment = function() {
                    var e = this.getCurrentEnvironmentByHost(),
                        t = g.getParameterValue("env");
                    return void 0 !== t && ("dev" === t ? e = p.Dev : "staging" === t ? e = p.Staging : "production" === t || "prod" === t ? e = p.Production : t.indexOf("-qa") > -1 && (e = p.QABox)), e
                }, e.prototype.getCurrentEnvironmentByHost = function() {
                    var e = this.getWindowHost();
                    return e.indexOf("-qa") >= 0 ? p.QABox : e.indexOf("dev.prodigygame.org") >= 0 || e.indexOf("prodigygame.net") >= 0 ? p.Dev : e.indexOf("prodigygame.org") >= 0 ? p.Staging : e.indexOf("prodigygame.com") >= 0 ? p.Production : p.Local
                }, e.prototype.getWindowHost = function() {
                    return window.location.host
                }, e
            }(),
            _ = function() {
                function e(t) {
                    var r = null != t ? t : this.getAPIRootUrl();
                    this._datafileUrl = "" + r + e.DATAFILE_ROUTE, this._trackingUrl = "" + r + e.TRACKING_ROUTE
                }
                return Object.defineProperty(e.prototype, "datafileUrl", {
                    get: function() {
                        return this._datafileUrl
                    },
                    enumerable: !1,
                    configurable: !0
                }), Object.defineProperty(e.prototype, "trackingUrl", {
                    get: function() {
                        return this._trackingUrl
                    },
                    enumerable: !1,
                    configurable: !0
                }), e.prototype.getAPIRootUrl = function() {
                    var e;
                    switch ((new E).getCurrentEnvironment()) {
                        case p.Production:
                            return "https://api.prodigygame.com";
                        case p.Staging:
                            return "https://api.prodigygame.org";
                        case p.Dev:
                            return "https://api.prodigygame.net";
                        case p.QABox:
                        case p.Local:
                            var t = g.getParameterValue("env");
                            if ((null == t ? void 0 : t.indexOf("-qa")) > -1) return "https://" + t + ".prodigygame." + (null !== (e = g.getParameterValue("boxEnv")) && void 0 !== e ? e : "org")
                    }
                    return ""
                }, e.DATAFILE_ROUTE = "/graphql/experiments/datafile", e.TRACKING_ROUTE = "/events-api/v1/experiments/track", e
            }(),
            v = function(e) {
                function t(r, n) {
                    var i, o, s = e.call(this, r, n) || this;
                    s._userAttributes = {}, s._experiments = {}, s._featureVariations = {}, s._activatedExperiments = new Set, s._endpoints = new _(null == n ? void 0 : n.domain);
                    var a = null !== (i = null == n ? void 0 : n.fetchTimeout) && void 0 !== i ? i : t.DEFAULT_DATAFILE_FETCH_TIMEOUT_MS;
                    return s._warningTime = Date.now() + a * t.WARNING_TIME_MULTIPLIER, s._datafileFetchRetryCount = null !== (o = null == n ? void 0 : n.fetchRetryCount) && void 0 !== o ? o : t.DEFAULT_DATAFILE_FETCH_RETRY_COUNT, (s._clientPromise = s.configure(a)).then((function() {
                        s._clientPromise = null
                    })).catch((function(e) {
                        s.log(e, u.error)
                    })), s
                }
                return i(t, e), t.prototype.configure = function(e) {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(t) {
                            return [2, this.getDataFile(e).then(this.configureWithDatafile.bind(this))]
                        }))
                    }))
                }, t.prototype.getDataFile = function(e) {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(r) {
                            return t._datafile ? [2, t._datafile] : Boolean(t._getDatafilePromise) ? [2, t._getDatafilePromise] : [2, t._getDatafilePromise = this.attemptToRetrieveDataFile(e)]
                        }))
                    }))
                }, t.prototype.attemptToRetrieveDataFile = function(e) {
                    return s(this, void 0, Promise, (function() {
                        var t, r, n, i;
                        return a(this, (function(o) {
                            switch (o.label) {
                                case 0:
                                    r = this._datafileFetchRetryCount + 1, o.label = 1;
                                case 1:
                                    if (!(r-- > 0)) return [3, 7];
                                    t = null, n = void 0, o.label = 2;
                                case 2:
                                    return o.trys.push([2, 4, , 5]), [4, Promise.race([this.retrieveDataFile(), this.timeout(e, "Timeout fetching optimizely datafile")])];
                                case 3:
                                    return n = o.sent(), [3, 5];
                                case 4:
                                    return i = o.sent(), t = i, [3, 5];
                                case 5:
                                    if (n) return [2, n];
                                    o.label = 6;
                                case 6:
                                    return [3, 1];
                                case 7:
                                    return [2, Promise.reject(t)]
                            }
                        }))
                    }))
                }, t.prototype.retrieveDataFile = function() {
                    return s(this, void 0, Promise, (function() {
                        var e = this;
                        return a(this, (function(t) {
                            return [2, new Promise((function(t, r) {
                                return s(e, void 0, void 0, (function() {
                                    var e, n, i;
                                    return a(this, (function(o) {
                                        switch (o.label) {
                                            case 0:
                                                return o.trys.push([0, 5, , 6]), [4, fetch(this._endpoints.datafileUrl)];
                                            case 1:
                                                return (e = o.sent()).ok ? [4, e.json()] : [3, 3];
                                            case 2:
                                                return n = o.sent(), t(n), [3, 4];
                                            case 3:
                                                r(new Error("Unable to fetch optimizely datafile")), o.label = 4;
                                            case 4:
                                                return [3, 6];
                                            case 5:
                                                return i = o.sent(), r(i), [3, 6];
                                            case 6:
                                                return [2]
                                        }
                                    }))
                                }))
                            }))]
                        }))
                    }))
                }, t.prototype.logOptimizelyMessage = function(e, r) {
                    var n;
                    this.log(r, null !== (n = t.LOG_LEVEL_MAP[e]) && void 0 !== n ? n : u.error)
                }, t.prototype.configureWithDatafile = function(e) {
                    var r = this;
                    this._client = l.createInstance({
                        datafile: e,
                        logger: {
                            log: this.logOptimizelyMessage.bind(this)
                        },
                        eventDispatcher: new d(this._endpoints, this.log.bind(this))
                    }), this._client.notificationCenter.addNotificationListener(l.enums.NOTIFICATION_TYPES.ACTIVATE, (function(e) {
                        r._activatedExperiments.has(e.experiment.key) || (r.log("isFeatureEnabled implicitly activated experiment " + e.experiment.key + ". Please call activate explicitly before making this query.", u.error), r._activatedExperiments.add(e.experiment.key))
                    })), t._datafile = e
                }, t.prototype.readyState = function() {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(e) {
                            switch (e.label) {
                                case 0:
                                    return this._warningTime = 0, this._client ? [2, this] : Boolean(this._clientPromise) ? [4, this._clientPromise] : [2, Promise.reject("Optimizely client has not been initialized and there is no pending request")];
                                case 1:
                                    return e.sent(), [2, this]
                            }
                        }))
                    }))
                }, t.prototype.isReady = function() {
                    return this._client ? Date.now() < this._warningTime && this.log("While Optimizely data is currently available, it is recommended that experiments this soon after initialization be done after awaiting a ready state", u.warning) : this.log("Optimizely client has not been initialized", u.error), !!this._client
                }, t.prototype.setUserAttribute = function(e, t) {
                    this._userAttributes[e] = t
                }, t.prototype.setUserAttributes = function(e) {
                    this._userAttributes = o(o({}, this._userAttributes), e)
                }, t.prototype.activate = function(e) {
                    this.isReady() && (this._activatedExperiments.add(e), this._client.activate(e, this._userId, this._userAttributes))
                }, t.prototype.isInExperiment = function(e) {
                    var t;
                    return Boolean(null === (t = this.getExperiment(e)) || void 0 === t ? void 0 : t.variationName)
                }, t.prototype.getExperimentGroup = function(e) {
                    var t;
                    return null === (t = this.getExperiment(e)) || void 0 === t ? void 0 : t.variationName
                }, t.prototype.forceExperimentGroup = function(e, t) {
                    return !!this.isReady() && !!this._client.setForcedVariation(e, this._userId, t) && (this._experiments[e] = null, this._featureVariations = {}, !0)
                }, t.prototype.isFeatureEnabled = function(e) {
                    var t;
                    return null === (t = this.getFeature(e)) || void 0 === t ? void 0 : t.enabled
                }, t.prototype.getFeatureVariable = function(e, t) {
                    var r;
                    return null === (r = this.getFeatureVariables(e)) || void 0 === r ? void 0 : r[t]
                }, t.prototype.getFeatureVariables = function(e) {
                    var t;
                    return null === (t = this.getFeature(e)) || void 0 === t ? void 0 : t.variables
                }, t.prototype.trackEvent = function(e, t) {
                    this.isReady() && this._client.track(e, this._userId, this._userAttributes, t)
                }, t.prototype.getExperiment = function(e) {
                    if (!this.isReady()) return null;
                    if (this._experiments[e]) return this._experiments[e];
                    var t = this._experiments[e] = {
                        variationName: null
                    };
                    return t.variationName = this._client.getVariation(e, this._userId, this._userAttributes), t
                }, t.prototype.getFeature = function(e) {
                    var r = this;
                    if (!this.isReady()) return null;
                    if (this._featureVariations[e]) return this._featureVariations[e];
                    var n = this._featureVariations[e] = {
                            enabled: !1,
                            variables: {}
                        },
                        i = t._datafile.featureFlags.find((function(t) {
                            return t.key === e
                        }));
                    return i ? (n.enabled = this._client.isFeatureEnabled(e, this._userId, this._userAttributes), i.variables.forEach((function(t) {
                        n.variables[t.key] = r.getOptimizelyFeatureVariable(e, t)
                    })), n) : n
                }, t.prototype.getOptimizelyFeatureVariable = function(e, t) {
                    switch (t.type.toLowerCase()) {
                        case "string":
                            return this._client.getFeatureVariableString(e, t.key, this._userId, this._userAttributes);
                        case "boolean":
                            return this._client.getFeatureVariableBoolean(e, t.key, this._userId, this._userAttributes);
                        case "integer":
                            return this._client.getFeatureVariableInteger(e, t.key, this._userId, this._userAttributes);
                        case "double":
                            return this._client.getFeatureVariableDouble(e, t.key, this._userId, this._userAttributes);
                        case "json":
                            return this._client.getFeatureVariableJSON(e, t.key, this._userId, this._userAttributes)
                    }
                    return null
                }, t.DEFAULT_DATAFILE_FETCH_TIMEOUT_MS = 8e3, t.DEFAULT_DATAFILE_FETCH_RETRY_COUNT = 3, t.LOG_LEVEL_MAP = ((h = {})[l.enums.LOG_LEVEL.NOTSET] = u.info, h[l.enums.LOG_LEVEL.INFO] = u.info, h[l.enums.LOG_LEVEL.DEBUG] = u.info, h[l.enums.LOG_LEVEL.WARNING] = u.warning, h[l.enums.LOG_LEVEL.ERROR] = u.error, h), t.WARNING_TIME_MULTIPLIER = 1.25, t
            }(f),
            I = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return i(t, e), t.prototype.activate = function(e) {
                    this.log("Not activating user in Optimizely. Experiment provider is in passive mode.", u.info)
                }, t.prototype.trackEvent = function(e, t) {
                    this.log("Not tracking event in Optimizely. Experiment provider is in passive mode.", u.info)
                }, t.prototype.configureWithDatafile = function(t) {
                    e.prototype.configureWithDatafile.call(this, t), this._client.sendImpressionEvent = function() {}
                }, t
            }(v);
        ! function(e) {
            function t() {
                var t = this || self;
                t.globalThis = t, delete e.prototype._T_
            }
            "object" != typeof globalThis && (this ? t() : (e.defineProperty(e.prototype, "_T_", {
                configurable: !0,
                get: t
            }), _T_))
        }(Object), globalThis;
        const y = {
                staleTTL: 6e4,
                cacheKey: "gbFeaturesCache",
                backgroundSync: !0
            },
            O = {
                fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : void 0,
                SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : void 0,
                EventSource: globalThis.EventSource,
                localStorage: globalThis.localStorage
            },
            T = new Map;
        let R = !1;
        const A = new Map,
            N = new Map,
            m = new Map,
            L = new Set;

        function b(e) {
            const [t, r] = e.getApiInfo();
            return ["".concat(t, "||").concat(r), t, r]
        }

        function U(e, t) {
            const r = t.dateUpdated || "",
                n = new Date(Date.now() + y.staleTTL),
                i = A.get(e);
            if (i && r && i.version === r) return void(i.staleAt = n);
            A.set(e, {
                data: t,
                version: r,
                staleAt: n
            }), async function() {
                try {
                    await O.localStorage.setItem(y.cacheKey, JSON.stringify(Array.from(A.entries())))
                } catch (e) {}
            }();
            const o = T.get(e);
            o && o.forEach((e => S(e, t)))
        }
        async function S(e, t) {
            await (t.encryptedFeatures ? e.setEncryptedFeatures(t.encryptedFeatures, void 0, O.SubtleCrypto) : e.setFeatures(t.features || e.getFeatures()))
        }
        async function D(e) {
            const [t, r, n] = b(e), i = r + "/api/features/" + n;
            let o = N.get(t);
            return o || (o = O.fetch(i).then((e => ("enabled" === e.headers.get("x-sse-support") && L.add(t), e.json()))).then((r => (U(t, r), C(e), N.delete(t), r))).catch((e => (N.delete(t), Promise.resolve({})))), N.set(t, o)), await o
        }

        function C(e) {
            const [t, r, n] = b(e);
            if (y.backgroundSync && L.has(t) && O.EventSource) {
                if (m.has(t)) return;
                const e = {
                    src: new O.EventSource("".concat(r, "/sub/").concat(n)),
                    cb: r => {
                        try {
                            const n = JSON.parse(r.data);
                            U(t, n), e.errors = 0
                        } catch (n) {
                            V(e, t)
                        }
                    },
                    errors: 0
                };
                m.set(t, e), e.src.addEventListener("features", e.cb), e.src.onerror = () => {
                    V(e, t)
                }
            }
        }

        function V(e, t) {
            e.errors++, (e.errors > 3 || 2 === e.src.readyState) && function(e, t) {
                e.src.onerror = null, e.src.close(), m.delete(t)
            }(e, t)
        }

        function P(e) {
            return function(e) {
                let t = 2166136261;
                const r = e.length;
                for (let n = 0; n < r; n++) t ^= e.charCodeAt(n), t += (t << 1) + (t << 4) + (t << 7) + (t << 8) + (t << 24);
                return t >>> 0
            }(e) % 1e3 / 1e3
        }
        const F = {};

        function M(e, t) {
            if ("$or" in t) return G(e, t.$or);
            if ("$nor" in t) return !G(e, t.$nor);
            if ("$and" in t) return function(e, t) {
                for (let r = 0; r < t.length; r++)
                    if (!M(e, t[r])) return !1;
                return !0
            }(e, t.$and);
            if ("$not" in t) return !M(e, t.$not);
            for (const [r, n] of Object.entries(t))
                if (!w(n, x(e, r))) return !1;
            return !0
        }

        function x(e, t) {
            const r = t.split(".");
            let n = e;
            for (let i = 0; i < r.length; i++) {
                if (!n || "object" != typeof n || !(r[i] in n)) return null;
                n = n[r[i]]
            }
            return n
        }

        function w(e, t) {
            if ("string" == typeof e) return t + "" === e;
            if ("number" == typeof e) return 1 * t === e;
            if ("boolean" == typeof e) return !!t === e;
            if (Array.isArray(e) || !k(e)) return JSON.stringify(t) === JSON.stringify(e);
            for (const r in e)
                if (!B(r, t, e[r])) return !1;
            return !0
        }

        function k(e) {
            const t = Object.keys(e);
            return t.length > 0 && t.filter((e => "$" === e[0])).length === t.length
        }

        function B(e, t, r) {
            switch (e) {
                case "$eq":
                    return t === r;
                case "$ne":
                    return t !== r;
                case "$lt":
                    return t < r;
                case "$lte":
                    return t <= r;
                case "$gt":
                    return t > r;
                case "$gte":
                    return t >= r;
                case "$exists":
                    return r ? null !== t : null === t;
                case "$in":
                    return r.includes(t);
                case "$nin":
                    return !r.includes(t);
                case "$not":
                    return !w(r, t);
                case "$size":
                    return !!Array.isArray(t) && w(r, t.length);
                case "$elemMatch":
                    return function(e, t) {
                        if (!Array.isArray(e)) return !1;
                        const r = k(t) ? e => w(t, e) : e => M(e, t);
                        for (let n = 0; n < e.length; n++)
                            if (e[n] && r(e[n])) return !0;
                        return !1
                    }(t, r);
                case "$all":
                    if (!Array.isArray(t)) return !1;
                    for (let e = 0; e < r.length; e++) {
                        let n = !1;
                        for (let i = 0; i < t.length; i++)
                            if (w(r[e], t[i])) {
                                n = !0;
                                break
                            }
                        if (!n) return !1
                    }
                    return !0;
                case "$regex":
                    try {
                        return (n = r, F[n] || (F[n] = new RegExp(n.replace(/([^\\])\//g, "$1\\/"))), F[n]).test(t)
                    } catch (i) {
                        return !1
                    }
                case "$type":
                    return function(e) {
                        if (null === e) return "null";
                        if (Array.isArray(e)) return "array";
                        const t = typeof e;
                        return ["string", "number", "boolean", "object", "undefined"].includes(t) ? t : "unknown"
                    }(t) === r;
                default:
                    return console.error("Unknown operator: " + e), !1
            }
            var n
        }

        function G(e, t) {
            if (!t.length) return !0;
            for (let r = 0; r < t.length; r++)
                if (M(e, t[r])) return !0;
            return !1
        }
        const j = "undefined" != typeof window && "undefined" != typeof document,
            K = e => Uint8Array.from(atob(e), (e => e.charCodeAt(0)));
        class Y {
            constructor(e) {
                e = e || {}, this._ctx = this.context = e, this._renderer = null, this._trackedExperiments = new Set, this._trackedFeatures = {}, this.debug = !1, this._subscriptions = new Set, this._rtQueue = [], this._rtTimer = 0, this.ready = !1, this._assigned = new Map, this._forcedFeatureValues = new Map, this._attributeOverrides = {}, e.features && (this.ready = !0), j && e.enableDevMode && (window._growthbook = this, document.dispatchEvent(new Event("gbloaded"))), e.clientKey && this._refresh({}, !0, !1)
            }
            async loadFeatures(e) {
                await this._refresh(e, !0, !0), e && e.autoRefresh && function(e) {
                    const [t] = b(e), r = T.get(t) || new Set;
                    r.add(e), T.set(t, r)
                }(this)
            }
            async refreshFeatures(e) {
                await this._refresh(e, !1, !0)
            }
            getApiInfo() {
                return [(this._ctx.apiHost || "https://cdn.growthbook.io").replace(/\/*$/, ""), this._ctx.clientKey || ""]
            }
            async _refresh(e, t, r) {
                if (e = e || {}, !this._ctx.clientKey) throw new Error("Missing clientKey");
                await async function(e, t, r, n, i) {
                    const o = await async function(e, t, r, n) {
                        const [i] = b(e), o = new Date;
                        await async function() {
                            if (!R && (R = !0, O.localStorage)) try {
                                const e = await O.localStorage.getItem(y.cacheKey);
                                if (e) {
                                    const t = JSON.parse(e);
                                    t && Array.isArray(t) && t.forEach((e => {
                                        let [t, r] = e;
                                        A.set(t, { ...r,
                                            staleAt: new Date(r.staleAt)
                                        })
                                    }))
                                }
                            } catch (e) {}
                        }();
                        const s = A.get(i);
                        return s && !n && (t || s.staleAt > o) ? (s.staleAt < o ? D(e) : C(e), s.data) : await
                        function(e, t) {
                            return new Promise((r => {
                                let n, i = !1;
                                const o = e => {
                                    i || (i = !0, n && clearTimeout(n), r(e || null))
                                };
                                t && (n = setTimeout((() => o()), t)), e.then((e => o(e))).catch((() => o()))
                            }))
                        }(D(e), r)
                    }(e, n, t, r);
                    i && o && await S(e, o)
                }(this, e.timeout, e.skipCache || this._ctx.enableDevMode, t, r)
            }
            _render() {
                this._renderer && this._renderer()
            }
            setFeatures(e) {
                this._ctx.features = e, this.ready = !0, this._render()
            }
            async setEncryptedFeatures(e, t, r) {
                if (t = t || this._ctx.decryptionKey || "", !(r = r || globalThis.crypto && globalThis.crypto.subtle)) throw new Error("No SubtleCrypto implementation found");
                try {
                    const n = await r.importKey("raw", K(t), {
                            name: "AES-CBC",
                            length: 128
                        }, !0, ["encrypt", "decrypt"]),
                        [i, o] = e.split("."),
                        s = await r.decrypt({
                            name: "AES-CBC",
                            iv: K(i)
                        }, n, K(o));
                    this.setFeatures(JSON.parse((new TextDecoder).decode(s)))
                } catch (n) {
                    throw new Error("Failed to decrypt features")
                }
            }
            setAttributes(e) {
                this._ctx.attributes = e, this._render()
            }
            setAttributeOverrides(e) {
                this._attributeOverrides = e, this._render()
            }
            setForcedVariations(e) {
                this._ctx.forcedVariations = e || {}, this._render()
            }
            setForcedFeatures(e) {
                this._forcedFeatureValues = e, this._render()
            }
            getAttributes() {
                return { ...this._ctx.attributes,
                    ...this._attributeOverrides
                }
            }
            getFeatures() {
                return this._ctx.features || {}
            }
            subscribe(e) {
                return this._subscriptions.add(e), () => {
                    this._subscriptions.delete(e)
                }
            }
            getAllResults() {
                return new Map(this._assigned)
            }
            destroy() {
                var e;
                this._subscriptions.clear(), this._assigned.clear(), this._trackedExperiments.clear(), this._trackedFeatures = {}, this._rtQueue = [], this._rtTimer && clearTimeout(this._rtTimer), e = this, T.forEach((t => t.delete(e))), j && window._growthbook === this && delete window._growthbook
            }
            setRenderer(e) {
                this._renderer = e
            }
            forceVariation(e, t) {
                this._ctx.forcedVariations = this._ctx.forcedVariations || {}, this._ctx.forcedVariations[e] = t, this._render()
            }
            run(e) {
                const t = this._run(e, null);
                return this._fireSubscriptions(e, t), t
            }
            _fireSubscriptions(e, t) {
                const r = e.key,
                    n = this._assigned.get(r);
                n && n.result.inExperiment === t.inExperiment && n.result.variationId === t.variationId || (this._assigned.set(r, {
                    experiment: e,
                    result: t
                }), this._subscriptions.forEach((r => {
                    try {
                        r(e, t)
                    } catch (n) {
                        console.error(n)
                    }
                })))
            }
            _trackFeatureUsage(e, t) {
                if ("override" === t.source) return;
                const r = JSON.stringify(t.value);
                if (this._trackedFeatures[e] !== r) {
                    if (this._trackedFeatures[e] = r, this._ctx.onFeatureUsage) try {
                        this._ctx.onFeatureUsage(e, t)
                    } catch (n) {}
                    j && window.fetch && (this._rtQueue.push({
                        key: e,
                        on: t.on
                    }), this._rtTimer || (this._rtTimer = window.setTimeout((() => {
                        this._rtTimer = 0;
                        const e = [...this._rtQueue];
                        this._rtQueue = [], this._ctx.realtimeKey && window.fetch("https://rt.growthbook.io/?key=".concat(this._ctx.realtimeKey, "&events=").concat(encodeURIComponent(JSON.stringify(e))), {
                            cache: "no-cache",
                            mode: "no-cors"
                        }).catch((() => {}))
                    }), this._ctx.realtimeInterval || 2e3)))
                }
            }
            _getFeatureResult(e, t, r, n, i, o) {
                const s = {
                    value: t,
                    on: !!t,
                    off: !t,
                    source: r,
                    ruleId: n || ""
                };
                return i && (s.experiment = i), o && (s.experimentResult = o), this._trackFeatureUsage(e, s), s
            }
            isOn(e) {
                return this.evalFeature(e).on
            }
            isOff(e) {
                return this.evalFeature(e).off
            }
            getFeatureValue(e, t) {
                var r;
                return null !== (r = this.evalFeature(e).value) && void 0 !== r ? r : t
            }
            feature(e) {
                return this.evalFeature(e)
            }
            evalFeature(e) {
                var t;
                if (this._forcedFeatureValues.has(e)) return this._getFeatureResult(e, this._forcedFeatureValues.get(e), "override");
                if (!this._ctx.features || !this._ctx.features[e]) return this._getFeatureResult(e, null, "unknownFeature");
                const r = this._ctx.features[e];
                if (r.rules)
                    for (const n of r.rules) {
                        if (n.condition && !this._conditionPasses(n.condition)) continue;
                        if ("force" in n) {
                            if ("coverage" in n) {
                                const {
                                    hashValue: t
                                } = this._getHashAttribute(n.hashAttribute);
                                if (!t) continue;
                                if (P(t + e) > n.coverage) continue
                            }
                            return this._getFeatureResult(e, n.force, "force", n.id)
                        }
                        if (!n.variations) continue;
                        const t = {
                            variations: n.variations,
                            key: n.key || e
                        };
                        "coverage" in n && (t.coverage = n.coverage), n.weights && (t.weights = n.weights), n.hashAttribute && (t.hashAttribute = n.hashAttribute), n.namespace && (t.namespace = n.namespace);
                        const r = this._run(t, e);
                        if (this._fireSubscriptions(t, r), r.inExperiment) return this._getFeatureResult(e, r.value, "experiment", n.id, t, r)
                    }
                return this._getFeatureResult(e, null !== (t = r.defaultValue) && void 0 !== t ? t : null, "defaultValue")
            }
            _conditionPasses(e) {
                return M(this.getAttributes(), e)
            }
            _run(e, t) {
                var r;
                const n = e.key,
                    i = e.variations.length;
                if (i < 2) return this._getResult(e, -1, !1, t);
                if (!1 === this._ctx.enabled) return this._getResult(e, -1, !1, t);
                e = this._mergeOverrides(e);
                const o = function(e, t, r) {
                    if (!t) return null;
                    const n = t.split("?")[1];
                    if (!n) return null;
                    const i = n.replace(/#.*/, "").split("&").map((e => e.split("=", 2))).filter((t => {
                        let [r] = t;
                        return r === e
                    })).map((e => {
                        let [, t] = e;
                        return parseInt(t)
                    }));
                    return i.length > 0 && i[0] >= 0 && i[0] < r ? i[0] : null
                }(n, this._getContextUrl(), i);
                if (null !== o) return this._getResult(e, o, !1, t);
                if (this._ctx.forcedVariations && n in this._ctx.forcedVariations) {
                    const r = this._ctx.forcedVariations[n];
                    return this._getResult(e, r, !1, t)
                }
                if ("draft" === e.status || !1 === e.active) return this._getResult(e, -1, !1, t);
                const {
                    hashValue: s
                } = this._getHashAttribute(e.hashAttribute);
                if (!s) return this._getResult(e, -1, !1, t);
                if (e.namespace && ! function(e, t) {
                        const r = P(e + "__" + t[0]);
                        return r >= t[1] && r < t[2]
                    }(s, e.namespace)) return this._getResult(e, -1, !1, t);
                if (e.include && ! function(e) {
                        try {
                            return e()
                        } catch (t) {
                            return console.error(t), !1
                        }
                    }(e.include)) return this._getResult(e, -1, !1, t);
                if (e.condition && !this._conditionPasses(e.condition)) return this._getResult(e, -1, !1, t);
                if (e.groups && !this._hasGroupOverlap(e.groups)) return this._getResult(e, -1, !1, t);
                if (e.url && !this._urlIsValid(e.url)) return this._getResult(e, -1, !1, t);
                const a = function(e) {
                        let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1,
                            r = arguments.length > 2 ? arguments[2] : void 0;
                        t < 0 ? t = 0 : t > 1 && (t = 1);
                        const n = function(e) {
                            return e <= 0 ? [] : new Array(e).fill(1 / e)
                        }(e);
                        r = r || n, r.length !== e && (r = n);
                        const i = r.reduce(((e, t) => t + e), 0);
                        (i < .99 || i > 1.01) && (r = n);
                        let o = 0;
                        return r.map((e => {
                            const r = o;
                            return o += e, [r, r + t * e]
                        }))
                    }(i, null !== (r = e.coverage) && void 0 !== r ? r : 1, e.weights),
                    u = function(e, t) {
                        for (let r = 0; r < t.length; r++)
                            if (e >= t[r][0] && e < t[r][1]) return r;
                        return -1
                    }(P(s + n), a);
                if (u < 0) return this._getResult(e, -1, !1, t);
                var l;
                if ("force" in e) return this._getResult(e, null !== (l = e.force) && void 0 !== l ? l : -1, !1, t);
                if (this._ctx.qaMode) return this._getResult(e, -1, !1, t);
                if ("stopped" === e.status) return this._getResult(e, -1, !1, t);
                const c = this._getResult(e, u, !0, t);
                return this._track(e, c), c
            }
            log(e, t) {
                this.debug && (this._ctx.log ? this._ctx.log(e, t) : console.log(e, t))
            }
            _track(e, t) {
                if (!this._ctx.trackingCallback) return;
                const r = e.key,
                    n = t.hashAttribute + t.hashValue + r + t.variationId;
                if (!this._trackedExperiments.has(n)) {
                    this._trackedExperiments.add(n);
                    try {
                        this._ctx.trackingCallback(e, t)
                    } catch (i) {
                        console.error(i)
                    }
                }
            }
            _mergeOverrides(e) {
                const t = e.key,
                    r = this._ctx.overrides;
                return r && r[t] && "string" == typeof(e = Object.assign({}, e, r[t])).url && (e.url = function(e) {
                    try {
                        const t = e.replace(/([^\\])\//g, "$1\\/");
                        return new RegExp(t)
                    } catch (t) {
                        return void console.error(t)
                    }
                }(e.url)), e
            }
            _getHashAttribute(e) {
                const t = e || "id";
                let r = "";
                return this._attributeOverrides[t] ? r = this._attributeOverrides[t] : this._ctx.attributes ? r = this._ctx.attributes[t] || "" : this._ctx.user && (r = this._ctx.user[t] || ""), {
                    hashAttribute: t,
                    hashValue: r
                }
            }
            _getResult(e, t, r, n) {
                let i = !0;
                (t < 0 || t >= e.variations.length) && (t = 0, i = !1);
                const {
                    hashAttribute: o,
                    hashValue: s
                } = this._getHashAttribute(e.hashAttribute);
                return {
                    featureId: n,
                    inExperiment: i,
                    hashUsed: r,
                    variationId: t,
                    value: e.variations[t],
                    hashAttribute: o,
                    hashValue: s
                }
            }
            _getContextUrl() {
                return this._ctx.url || (j ? window.location.href : "")
            }
            _urlIsValid(e) {
                const t = this._getContextUrl();
                if (!t) return !1;
                const r = t.replace(/^https?:\/\//, "").replace(/^[^/]*\//, "/");
                return !!e.test(t) || !!e.test(r)
            }
            _hasGroupOverlap(e) {
                const t = this._ctx.groups || {};
                for (let r = 0; r < e.length; r++)
                    if (t[e[r]]) return !0;
                return !1
            }
        }
        var H, z = function() {
                function e(e) {
                    this._domain = "https://growthbook-cdn.prodigygame.com", this._datafileUrl = null != e ? e : this.getAPIRootUrl()
                }
                return e.prototype.getAPIRootUrl = function() {
                    var e, t = (new E).getCurrentEnvironment();
                    if (t === p.QABox || t === p.Local) switch (null !== (e = g.getParameterValue("boxEnv")) && void 0 !== e ? e : "org") {
                        case "com":
                            return this._domain + "/datafile";
                        case "org":
                            return this._domain + "/staging/datafile";
                        case "net":
                            return this._domain + "/dev/datafile"
                    }
                    switch (t) {
                        case p.Production:
                            return this._domain + "/datafile";
                        case p.Staging:
                            return this._domain + "/staging/datafile";
                        case p.Dev:
                            return this._domain + "/dev/datafile"
                    }
                    return ""
                }, e
            }(),
            J = function(e) {
                function t(r, n) {
                    var i, o, s = e.call(this, r, n) || this;
                    s._userAttributes = {}, s._endpoints = new z(null == n ? void 0 : n.domain), s._datafileFetchRetryCount = null !== (i = null == n ? void 0 : n.fetchRetryCount) && void 0 !== i ? i : t.DEFAULT_DATAFILE_FETCH_RETRY_COUNT;
                    var a = null !== (o = null == n ? void 0 : n.fetchTimeout) && void 0 !== o ? o : t.DEFAULT_DATAFILE_FETCH_TIMEOUT_MS;
                    return s._userAttributes.id = r, (s._clientPromise = s.configure(a)).then((function() {
                        s._clientPromise = null
                    })).catch((function(e) {
                        s.log(e, u.error)
                    })), s
                }
                return i(t, e), t.prototype.readyState = function() {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(e) {
                            switch (e.label) {
                                case 0:
                                    return this._growthBookClient ? [2, this] : Boolean(this._clientPromise) ? [4, this._clientPromise] : [2, Promise.reject("GrowthBook client has not been initialized and there is no pending request")];
                                case 1:
                                    return e.sent(), [2, this]
                            }
                        }))
                    }))
                }, t.prototype.setUserAttribute = function(e, t) {
                    this._userAttributes[e] = t, this._growthBookClient && this._growthBookClient.setAttributes(this._userAttributes)
                }, t.prototype.setUserAttributes = function(e) {
                    this._userAttributes = o(o({}, this._userAttributes), e), this._growthBookClient && this._growthBookClient.setAttributes(this._userAttributes)
                }, t.prototype.isInExperiment = function(e) {
                    var t, r = this.evalFeature(e);
                    return Boolean(null === (t = null == r ? void 0 : r.experimentResult) || void 0 === t ? void 0 : t.inExperiment)
                }, t.prototype.getExperimentGroup = function(e) {
                    var t, r, n = this.evalFeature(e);
                    return null === (r = null === (t = null == n ? void 0 : n.experimentResult) || void 0 === t ? void 0 : t.variationId) || void 0 === r ? void 0 : r.toString()
                }, t.prototype.forceExperimentGroup = function(e, t) {
                    var r;
                    return this._growthBookClient.forceVariation(e, null !== (r = parseFloat(t)) && void 0 !== r ? r : 0), !0
                }, t.prototype.isFeatureEnabled = function(e) {
                    return this.evalFeature(e).on
                }, t.prototype.getFeatureVariable = function(e, t) {
                    var r = this.getFeatureVariables(e);
                    return "value" in r && 1 === Object.keys(r).length ? r.value : r[t]
                }, t.prototype.getFeatureVariables = function(e) {
                    var t = this.evalFeature(e);
                    return null !== (null == t ? void 0 : t.value) && "object" == typeof(null == t ? void 0 : t.value) ? null == t ? void 0 : t.value : {
                        value: null == t ? void 0 : t.value
                    }
                }, t.prototype.trackEvent = function(e, t) {}, t.prototype.activate = function(e) {}, t.prototype.evalFeature = function(e) {
                    return this._growthBookClient.evalFeature(e)
                }, t.prototype.configure = function(e) {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(t) {
                            return [2, this.getDataFile(e).then(this.configureWithDatafile.bind(this))]
                        }))
                    }))
                }, t.prototype.configureWithDatafile = function(e) {
                    this._growthBookClient = new Y({
                        enableDevMode: !0,
                        features: e,
                        attributes: this._userAttributes
                    }), t._datafile = e, this._growthBookClient.setAttributes(this._userAttributes)
                }, t.prototype.getDataFile = function(e) {
                    return s(this, void 0, Promise, (function() {
                        return a(this, (function(r) {
                            return t._datafile ? [2, t._datafile] : Boolean(t._getDatafilePromise) ? [2, t._getDatafilePromise] : [2, t._getDatafilePromise = this.attemptToRetrieveDataFile(e)]
                        }))
                    }))
                }, t.prototype.attemptToRetrieveDataFile = function(e) {
                    return s(this, void 0, Promise, (function() {
                        var t, r, n, i;
                        return a(this, (function(o) {
                            switch (o.label) {
                                case 0:
                                    t = null, r = this._datafileFetchRetryCount + 1, o.label = 1;
                                case 1:
                                    if (!(r-- > 0)) return [3, 7];
                                    n = void 0, o.label = 2;
                                case 2:
                                    return o.trys.push([2, 4, , 5]), [4, Promise.race([this.retrieveDataFile(), this.timeout(e, "Timeout fetching growthbook datafile")])];
                                case 3:
                                    return n = o.sent(), [3, 5];
                                case 4:
                                    return i = o.sent(), t = i, [3, 5];
                                case 5:
                                    if (n) return [2, n];
                                    o.label = 6;
                                case 6:
                                    return [3, 1];
                                case 7:
                                    return [2, Promise.reject(t)]
                            }
                        }))
                    }))
                }, t.prototype.retrieveDataFile = function() {
                    return s(this, void 0, Promise, (function() {
                        var e, t, r;
                        return a(this, (function(n) {
                            switch (n.label) {
                                case 0:
                                    return n.trys.push([0, 7, , 8]), [4, fetch(this._endpoints._datafileUrl)];
                                case 1:
                                    return 200 !== (e = n.sent()).status ? [3, 4] : [4, e.json()];
                                case 2:
                                    return t = n.sent(), [4, Promise.resolve(t.features)];
                                case 3:
                                case 5:
                                    return [2, n.sent()];
                                case 4:
                                    return [4, Promise.reject(new Error("Unable to fetch Growthbook datafile"))];
                                case 6:
                                    return [3, 8];
                                case 7:
                                    return r = n.sent(), [2, Promise.reject(r)];
                                case 8:
                                    return [2]
                            }
                        }))
                    }))
                }, t.DEFAULT_DATAFILE_FETCH_TIMEOUT_MS = 8e3, t.DEFAULT_DATAFILE_FETCH_RETRY_COUNT = 3, t
            }(f);
        ! function(e) {
            e[e.optimizely = 0] = "optimizely", e[e.optimizelyPassive = 1] = "optimizelyPassive", e[e.growthBook = 2] = "growthBook"
        }(H || (H = {}));
        var q = function() {
            function e() {}
            return e.createExperimentProvider = function(e, t, r) {
                switch (void 0 === r && (r = H.optimizely), r) {
                    case H.optimizely:
                        return new v(e, t);
                    case H.optimizelyPassive:
                        return new I(e, t);
                    case H.growthBook:
                        return new J(e, t)
                }
                throw new Error("Specified experiment provider is unavailable")
            }, e
        }()
    }])
}));